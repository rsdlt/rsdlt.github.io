<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Building a Real-Time Web Cipher with Rust, Sycamore and Trunk" /><meta name="author" content="rsdlt" /><meta property="og:locale" content="en" /><meta name="description" content="Check the demo and the GitHub repo." /><meta property="og:description" content="Check the demo and the GitHub repo." /><link rel="canonical" href="https://rsdlt.github.io/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/" /><meta property="og:url" content="https://rsdlt.github.io/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/" /><meta property="og:site_name" content="the trait" /><meta property="og:image" content="https://rsdlt.github.io/assets/img/vigenere-cypher-iterators/2022-09-25%2015-48.gif" /><meta property="og:image:height" content="334" /><meta property="og:image:width" content="885" /><meta property="og:image:alt" content="WASM Vigenére Cipher" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-27T13:00:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://rsdlt.github.io/assets/img/vigenere-cypher-iterators/2022-09-25%2015-48.gif" /><meta name="twitter:image:alt" content="WASM Vigenére Cipher" /><meta property="twitter:title" content="Building a Real-Time Web Cipher with Rust, Sycamore and Trunk" /><meta name="twitter:site" content="@_rsdlt" /><meta name="twitter:creator" content="@rsdlt" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"rsdlt"},"dateModified":"2022-10-03T11:04:09-04:00","datePublished":"2022-09-27T13:00:00-04:00","description":"Check the demo and the GitHub repo.","headline":"Building a Real-Time Web Cipher with Rust, Sycamore and Trunk","image":{"width":885,"height":334,"alt":"WASM Vigenére Cipher","url":"https://rsdlt.github.io/assets/img/vigenere-cypher-iterators/2022-09-25%2015-48.gif","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rsdlt.github.io/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/"},"url":"https://rsdlt.github.io/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/"}</script><title>Building a Real-Time Web Cipher with Rust, Sycamore and Trunk | the trait</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="the trait"><meta name="application-name" content="the trait"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/rsdlt_bw.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">the trait</a></div><div class="site-subtitle font-italic">Rodrigo Santiago</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rsdlt" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['rsdlt','pm.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/rsdlt/" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1664298000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 27, 2022 </em> </span> <span> Updated <em class="" data-ts="1664809449" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Oct 3, 2022 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/vigenere-cypher-iterators/2022-09-25 15-48.gif" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/2022-09-25 15-48.gif" alt="WASM Vigenére Cipher" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">WASM Vigenére Cipher</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="3930 words"> <em>21 min</em> read</span></div></div></div><div class="post-content"><blockquote><p>Check the <a href="https://wasm-vigenere-cipher.onrender.com/">demo</a> and the <a href="https://github.com/rsdlt/wasm-vigenere-cipher">GitHub</a> repo.</p></blockquote><blockquote class="prompt-info"><p><strong>Edit:</strong> Since the original post some readers brought to my attention a bug that yielded incorrect decoding. This is now fixed in release <a href="https://github.com/rsdlt/wasm-vigenere-cipher/releases/tag/v0.1.2">v0.1.2</a>. Thanks to <a href="https://github.com/MartinKavik">Martin Kavík</a> and others for letting me know. I also added support to properly display multiple continuous space and new line chars in the decoded text in <a href="https://github.com/rsdlt/wasm-vigenere-cipher/releases/tag/v0.1.3">v0.1.3</a>. You can check the details in the <a href="#updates-fixes-and-new-features">updates below</a>.</p></blockquote><p>Some days ago I came across Tim McNamara’s <a href="https://www.linkedin.com/learning/rust-code-challenges/let-s-put-rust-into-practice?autoplay=true">Rust Code Challenges</a>, a great course by the way, where the final challenge is to develop a <a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenère cipher</a>, which according to Wikipedia resisted all attempts to break it for 310 years.</p><p>After completing Tim’s challenge, I thought that deploying a real-time Vigenére cipher on the Web, and without touching a single line of <a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">JavaScript</a> code would be a fun project.</p><p>Truth is, I loved it!</p><h2 id="quick-summary-of-the-vigenére-cipher"><span class="mr-2">Quick summary of the Vigenére cipher</span><a href="#quick-summary-of-the-vigenére-cipher" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The Vigenére cipher is a simplified poly-alphabetic <a href="https://en.wikipedia.org/wiki/Substitution_cipher">substitution</a> encoder. It’s essentially an algorithm where a set of characters or <em>message</em> is substituted with another set of characters or <em>encoded message</em> with the help of a <em>key</em>. To decode the encoded message, the receiver performs the inverse substitution process.</p><p>The algorithm has 6 steps:</p><ol><li>Define an <em>alphabet</em> or <em>dictionary</em>: the set of characters.<li>Generate a <em>Vigenére table</em>: a matrix based on the <em>dictionary</em> with a cyclical shift for each row.<li>Define a <em>Key</em>: a sequence of units based on the <em>dictionary</em>.<li>Define a <em>Message</em> to encode / decode: another sequence of units based on of the <em>dictionary</em>.<li>Make the <em>Key</em> and the <em>Message</em> have the same size (number of units or characters).<li>Encode / Decode by matching each unit (or character) in the message and the key in the <em>Vigenére table</em>.</ol><p>For example:</p><ul><li>Dictionary: ABCD<li>Vigenére Matrix:</ul><div class="table-wrapper"><table><thead><tr><th>A<th>B<th>C<th>D<tbody><tr><td>B<td>C<td>D<td>A<tr><td>C<td>D<td>A<td>B<tr><td>D<td>A<td>B<td>C</table></div><ul><li>Key: DCABAD<li>Message: BADCAD<li>Encode:<ul><li>Message characters [mc] =&gt; column position according to first row = Matrix[0][mc]<li>Key characters [kc] =&gt; row position according to first column = Matrix[kc][0]<li>Encoded characters [ec] = Matrix[kc][mc]</ul><li>Decode:<ul><li>Decode character [dc] = Matrix[0][ec]</ul></ul><p>In the case of the first characters Key[0] = ‘D’ and Message[0] = ‘B’ the encoded character is Matrix[3][1] = ‘A’:</p><div class="table-wrapper"><table><thead><tr><th>A<th><code class="language-plaintext highlighter-rouge">-B-</code><th>C<th>D<tbody><tr><td>B<td>C<td>D<td>A<tr><td>C<td>D<td>A<td>B<tr><td><code class="language-plaintext highlighter-rouge">-D-</code><td><code class="language-plaintext highlighter-rouge">-A-</code><td>B<td>C</table></div><h2 id="requirements-for-my-implementation"><span class="mr-2">Requirements for my implementation</span><a href="#requirements-for-my-implementation" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>This were my requirements for this implementation (at least for its <code class="language-plaintext highlighter-rouge">v0.1.0</code>):</p><ul><li>Implemented in <a href="https://www.rust-lang.org/">Rust</a>.<li>Make it <em>real-time</em>: encode and decode while typing the message.<li>Deploy on the Web using WebAssembly<li>Don’t touch a line of JavaScript - because if we can do everything in Rust, then why not?</ul><h2 id="webassembly--sycamore--trunk"><span class="mr-2">WebAssembly + Sycamore + Trunk</span><a href="#webassembly--sycamore--trunk" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Based on the requirements, I decided that the best technology stack for this project is the following:</p><ul><li><a href="https://webassembly.org/">WebAssembly</a>:<ul><li>Which according to <a href="http://127.0.0.1:4000/posts/vigenere-cypher-wasm-rust-iterator-function/">MDN Web Docs</a> is <em>“… a low-level assembly-like language with a compact binary that runs <strong>near-native</strong> performance and provides languages such as Rust with a compilation target…”</em><li>So essentially, we write the code in Rust, compile to WebAssembly and any of the 4 major web browsers will <a href="https://webassembly.org/roadmap/">support it</a>.</ul><li><a href="https://sycamore-rs.netlify.app/">Sycamore</a>:<ul><li>Which based on their web page is <em>“… a <strong>reactive</strong> library for creating web apps in Rust and WebAssembly…”</em> that can be used to <em>“… create apps without touching a single line of JS… “</em>.<li>So two big wins here: no JS and reactivity to support real-time encryption / decryption.</ul><li><a href="https://trunkrs.dev/">Trunk</a>:<ul><li>Which according to the project website is used to <em>“… build, bundle &amp; ship your Rust WASM application to the web… “</em>.<li>Pretty neat, and it’s also the <a href="https://sycamore-rs.netlify.app/docs/getting_started/installation#install-trunk">recommended build tool</a> for Sycamore.</ul></ul><p>This is a very powerful triad.</p><h2 id="the-solution"><span class="mr-2">The solution</span><a href="#the-solution" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>For a clear perspective, this is how all the pieces fit together:</p><p><a href="/assets/img/vigenere-cypher-iterators/general-solution-diagram.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 793 324'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/general-solution-diagram.png" alt="Vigenère cipher solution diagram" width="793" height="324" class="lazyload" data-proofer-ignore></a> <em>Vigenére cipher general solution diagram</em></p><ul><li>The Sycamore library is like any other crate imported via <code class="language-plaintext highlighter-rouge">Cargo.toml</code>.<li>The elements in green (<code class="language-plaintext highlighter-rouge">cipher.rs</code>, <code class="language-plaintext highlighter-rouge">main.rs</code> and <code class="language-plaintext highlighter-rouge">Cargo.toml</code>) are our Rust application.<li>The ‘tiny placeholder’ <code class="language-plaintext highlighter-rouge">index.html</code> is a minimum HTML source file used by Trunk to inject the <code class="language-plaintext highlighter-rouge">views</code> provided by Sycamore.<li>The entire Rust project is compiled, built and bundled using Trunk.<li>Trunk generates the assets for distribution and hosting:<ul><li>WebAssembly <code class="language-plaintext highlighter-rouge">binary</code> targeting the wasm32 instruction set.<li>The target HTML file.<li>The “glue” JavaScript file facilitating <a href="https://developer.mozilla.org/en-US/docs/WebAssembly/JavaScript_interface">interaction</a> with WebAssembly.</ul></ul><p>These great benefit of this stack is that all the logic is coded in Rust, even the front-end HTML logic.</p><h2 id="the-front-end-logic-and-ui-elements"><span class="mr-2">The front-end logic and UI elements</span><a href="#the-front-end-logic-and-ui-elements" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>What really caught my attention with Sycamore is how straightforward it is to define the web user interface components and elements.</p><p>The user interface is handled through a <a href="https://sycamore-rs.netlify.app/docs/basics/view">view!</a> Rust macro with no closing HTML tags:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span>
    <span class="n">h1</span> <span class="p">{</span> <span class="p">}</span>
    <span class="nf">div</span><span class="p">(</span><span class="n">class</span><span class="o">=</span><span class="s">"my_class"</span><span class="p">)</span>
    <span class="n">h2</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">p</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">div</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">my</span><span class="o">-</span><span class="n">own</span><span class="o">-</span><span class="n">custom</span><span class="o">-</span><span class="n">element</span> <span class="p">{</span> <span class="p">}</span>
    <span class="n">footer</span> <span class="p">{</span> <span class="p">}</span>

    <span class="c1">// etc.</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This simplicity allowed me to create the initial boilerplate application, with placeholders, and project structure in minutes:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">mod</span> <span class="n">cipher</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">cipher</span><span class="p">::</span><span class="n">Hello</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">sycamore</span><span class="p">::</span><span class="nn">prelude</span><span class="p">::</span><span class="o">*</span><span class="p">;</span>

<span class="nd">#[component]</span>
<span class="k">fn</span> <span class="n">App</span><span class="o">&lt;</span><span class="n">G</span><span class="p">:</span> <span class="n">Html</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cx</span><span class="p">:</span> <span class="n">Scope</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">View</span><span class="o">&lt;</span><span class="n">G</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">name</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">hello_r</span> <span class="o">=</span> <span class="nn">cipher</span><span class="p">::</span><span class="nf">new_hello</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">displayed_name</span> <span class="o">=</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">name</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="s">""</span><span class="nf">.to_string</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">name</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">};</span>

    <span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span>
        <span class="n">div</span> <span class="p">{</span>
            <span class="n">h2</span> <span class="p">{</span> <span class="s">"Real-Time Vigénere Cipher"</span> <span class="p">}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="nf">input</span><span class="p">(</span><span class="n">placeholder</span><span class="o">=</span><span class="s">"Enter a phrase"</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span><span class="n">value</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Key: "</span><span class="p">}</span> <span class="p">(</span><span class="nf">displayed_name</span><span class="p">())}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Encrypted: "</span><span class="p">}</span> <span class="p">(</span><span class="nf">displayed_name</span><span class="p">())}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Decrypted: "</span><span class="p">}</span> <span class="p">(</span><span class="nf">displayed_name</span><span class="p">())}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nn">sycamore</span><span class="p">::</span><span class="nf">render</span><span class="p">(|</span><span class="n">cx</span><span class="p">|</span> <span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span> <span class="n">App</span> <span class="p">{}</span> <span class="p">});</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">index.html</code>: (the tiny one)</p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;title&gt;</span>WebAssembly Vigénere Cipher<span class="nt">&lt;/title&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span><span class="p">;</span>

<span class="k">pub</span> <span class="k">struct</span> <span class="n">Hello</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
<span class="p">}</span>
<span class="k">pub</span> <span class="k">fn</span> <span class="nf">new_hello</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">Hello</span> <span class="p">{</span>
    <span class="n">Hello</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s">"Rodrigo"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="k">impl</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Hello</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="nd">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">"{}"</span><span class="p">,</span> <span class="k">self</span><span class="py">.name</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Cargo.toml</code>:</p><div class="language-toml highlighter-rouge"><div class="code-header"> <span data-label-text="TOML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nn">[package]</span>
<span class="py">name</span> <span class="p">=</span> <span class="s">"wasm-vigenere-cipher"</span>
<span class="py">version</span> <span class="p">=</span> <span class="s">"0.1.0"</span>
<span class="py">edition</span> <span class="p">=</span> <span class="s">"2021"</span>

<span class="c"># See more keys and their definitions at https://doc.rust-lang.org/cargo/reference/manifest.html</span>

<span class="nn">[dependencies]</span>
<span class="py">sycamore</span> <span class="p">=</span> <span class="s">"0.8.1"</span>
</pre></table></code></div></div><p>With this minimum of scaffolding we can now call Trunk with <code class="language-plaintext highlighter-rouge">trunk serve --open</code>, let it download, compile and bundle:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre><td class="rouge-code"><pre><span class="go"> 
 λ trunk serve --open
2022-09-28T01:49:43.120298Z  INFO  starting build
2022-09-28T01:49:43.123032Z  INFO spawning asset pipelines
2022-09-28T01:49:50.045688Z  INFO building tmp
   Compiling proc-macro2 v1.0.44
   Compiling unicode-ident v1.0.4
   Compiling quote v1.0.21
   Compiling syn v1.0.101
   Compiling wasm-bindgen-shared v0.2.83
</span><span class="c">    .
    .
    .
</span><span class="go">    Finished dev [unoptimized + debuginfo] target(s) in 0.46s
2022-09-28T01:50:41.373388Z  INFO fetching cargo artifacts
2022-09-28T01:50:41.441605Z  INFO processing WASM for tmp
2022-09-28T01:50:41.449095Z  INFO using system installed binary app=wasm-bindgen version=0.2.83
2022-09-28T01:50:41.449384Z  INFO calling wasm-bindgen for tmp
2022-09-28T01:50:41.547182Z  INFO copying generated wasm-bindgen artifacts
2022-09-28T01:50:41.550548Z  INFO applying new distribution
2022-09-28T01:50:41.551202Z  INFO  success
</span></pre></table></code></div></div><p>Trunk spawns a web server and opens the browser window to a fully reactive application written in Rust:</p><p><a href="/assets/img/vigenere-cypher-iterators/first-reactive-web.gif" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 665 253'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/first-reactive-web.gif" alt="boilerplate reactive web app in Rust" width="665" height="253" class="lazyload" data-proofer-ignore></a> <em>Boilerplate Reactive Web App in Rust with Sycamore and Trunk</em></p><p>And looking closely at the output from Trunk in the <code class="language-plaintext highlighter-rouge">/dist/</code> directory:</p><p><code class="language-plaintext highlighter-rouge">/dist/</code></p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go"> λ la dist
.rw-r--r-- 1.4k rsdlt 27 Sep 21:50  index.html
.rw-r--r--  18k rsdlt 27 Sep 21:50  tmp-4f46f36b75886b4e.js
.rw-r--r-- 943k rsdlt 27 Sep 21:50  tmp-4f46f36b75886b4e_bg.wasm
</span></pre></table></code></div></div><p>We see the three files of the web application needed for any hosting service.</p><h2 id="implementing-the-cipher"><span class="mr-2">Implementing the cipher</span><a href="#implementing-the-cipher" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>With this boilerplate web application the next step is to implement the actual Vigenére cipher logic in the <code class="language-plaintext highlighter-rouge">cipher.rs</code>, according to the <a href="#quick-summary-of-the-vigenére-cipher">6 steps outlined above</a>:</p><h3 id="1-define-the-alphabet-or-dictionary"><span class="mr-2">1. Define the ‘alphabet’ or ‘dictionary’</span><a href="#1-define-the-alphabet-or-dictionary" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At least for an MVP <code class="language-plaintext highlighter-rouge">v0.1.0</code> I have decided on all the non-control ASCII characters plus ‘\n’ and ‘\r’ which yields a set of <code class="language-plaintext highlighter-rouge">192</code> characters.</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">const</span> <span class="n">SIZE</span><span class="p">:</span> <span class="nb">usize</span> <span class="o">=</span> <span class="mi">192</span><span class="p">;</span>

<span class="nd">#[derive(Clone,</span> <span class="nd">Copy)]</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">struct</span> <span class="nf">DictWrap</span><span class="p">(</span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="p">[</span><span class="nb">char</span><span class="p">;</span> <span class="n">SIZE</span><span class="p">]);</span>

</pre></table></code></div></div><p>I am using an <code class="language-plaintext highlighter-rouge">array</code> of <code class="language-plaintext highlighter-rouge">chars</code> with a size defined by a <code class="language-plaintext highlighter-rouge">const</code> and wrapped by a <code class="language-plaintext highlighter-rouge">tuple struct</code>.</p><p>The reasoning of using a wrapper is because Arrays are always treated as foreign types and the wrap allow for the implementation of foreign traits on them, like <code class="language-plaintext highlighter-rouge">std::fmt::Display</code>.</p><p>The actual implementation for the <code class="language-plaintext highlighter-rouge">DictWrap</code> type is:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre><td class="rouge-code"><pre><span class="c1">// Creates and returns a new dictionary for the Vigenere Matrix.</span>
<span class="k">impl</span> <span class="n">DictWrap</span> <span class="p">{</span>
    <span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">DictWrap</span> <span class="p">{</span>
        <span class="c1">// Every ASCII character that !is_control().</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">dict</span> <span class="o">=</span> <span class="s">r##" !"#$%&amp;'()*+,-./0123456789:;&lt;=&gt;?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ¡¢£¤¥¦§¨©ª«¬­®¯°±²³´µ¶·¸¹º»¼½¾¿ÀÁÂÃÄÅÆÇÈÉÊËÌÍÎÏÐÑÒÓÔÕÖ×ØÙÚÛÜÝÞßàáâãäåæçèéêëìíîïðñòóôõö÷øùúûüýþÿ"##</span><span class="nf">.to_string</span><span class="p">();</span>
        <span class="c1">// Add carriage return to support in web textarea.</span>
        <span class="n">dict</span><span class="nf">.push</span><span class="p">(</span><span class="sc">'\n'</span><span class="p">);</span>
        <span class="n">dict</span><span class="nf">.push</span><span class="p">(</span><span class="sc">'\r'</span><span class="p">);</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">dict_char_arr</span> <span class="o">=</span> <span class="p">[</span><span class="sc">' '</span><span class="p">;</span> <span class="n">SIZE</span><span class="p">];</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">ch</span><span class="p">)</span> <span class="k">in</span> <span class="n">dict</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">dict_char_arr</span><span class="p">[</span><span class="n">idx</span><span class="p">]</span> <span class="o">=</span> <span class="n">ch</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="nf">DictWrap</span><span class="p">(</span><span class="n">dict_char_arr</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">get_string</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">();</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="k">in</span> <span class="k">self</span><span class="na">.0</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.push</span><span class="p">(</span><span class="n">ch</span><span class="p">);</span>
        <span class="p">}</span>
        <span class="n">s</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>First, defining the actual set in a raw <code class="language-plaintext highlighter-rouge">&amp;str</code>, converting to <code class="language-plaintext highlighter-rouge">String</code> to push both carriage return chars <code class="language-plaintext highlighter-rouge">\n</code> and <code class="language-plaintext highlighter-rouge">\r</code> and then populating the <code class="language-plaintext highlighter-rouge">char array</code> and wrap it with the <code class="language-plaintext highlighter-rouge">struct tuple</code> (the <a href="https://rsdlt.github.io/posts/rust-use-newtype-pattern-display-trait-array-generics/">Newtype Pattern</a>).</p><p>I’m including a <code class="language-plaintext highlighter-rouge">get_string()</code> method in order to return the array in <code class="language-plaintext highlighter-rouge">String</code> form in case is needed for rendering in <code class="language-plaintext highlighter-rouge">HTML</code>.</p><h3 id="2-generate-a-vigenére-matrix"><span class="mr-2">2. Generate a Vigenére Matrix</span><a href="#2-generate-a-vigenére-matrix" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The next step is to create the Vigenére table or matrix with the cycled and shifted elements of the <code class="language-plaintext highlighter-rouge">dictionary</code>:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="nd">#[derive(Clone,</span> <span class="nd">Copy)]</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">struct</span> <span class="nf">VigMatrixWrap</span><span class="p">(</span><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="p">[[</span><span class="nb">char</span><span class="p">;</span> <span class="n">SIZE</span><span class="p">];</span> <span class="n">SIZE</span><span class="p">]);</span>

<span class="c1">// Creates and returns a new Vigenere Matrix.</span>
<span class="k">impl</span> <span class="n">VigMatrixWrap</span> <span class="p">{</span>
    <span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">new</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="n">VigMatrixWrap</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">mat</span><span class="p">:</span> <span class="n">VigMatrixWrap</span> <span class="o">=</span> <span class="nf">VigMatrixWrap</span><span class="p">([[</span><span class="sc">' '</span><span class="p">;</span> <span class="n">SIZE</span><span class="p">];</span> <span class="n">SIZE</span><span class="p">]);</span>
        <span class="k">let</span> <span class="n">binding</span> <span class="o">=</span> <span class="nn">DictWrap</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span><span class="na">.0</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">acc</span> <span class="o">=</span> <span class="n">binding</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.cycle</span><span class="p">();</span>

        <span class="k">for</span> <span class="n">r</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">mat</span><span class="na">.0</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">mat</span><span class="na">.0</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
                <span class="n">mat</span><span class="na">.0</span><span class="p">[</span><span class="n">r</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">=</span> <span class="o">*</span><span class="n">acc</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">();</span>
            <span class="p">}</span>
            <span class="n">acc</span><span class="nf">.next</span><span class="p">();</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="n">mat</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Again using the <code class="language-plaintext highlighter-rouge">Newtype Pattern</code> on the 2D array in order to have flexibility to implement foreign traits on it.</p><p>And the other interesting part is the use of the <a href="https://doc.rust-lang.org/std/iter/struct.Cycle.html">cycle iterator</a>, which essentially repeats itself endlessly. With every new row in the <code class="language-plaintext highlighter-rouge">for</code> cycle the <code class="language-plaintext highlighter-rouge">acc</code> cycle iterator is shifting in the proper order.</p><h3 id="3-define-a-key"><span class="mr-2">3. Define a Key</span><a href="#3-define-a-key" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>At least for MVP <code class="language-plaintext highlighter-rouge">v0.1.0</code> the key is a fixed <code class="language-plaintext highlighter-rouge">&amp;str</code> hard-coded in <code class="language-plaintext highlighter-rouge">main.rs</code>:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre>    
    <span class="k">let</span> <span class="n">key</span> <span class="o">=</span> <span class="s">"°¡! RüST íS CóÓL ¡!°"</span><span class="p">;</span>
    
</pre></table></code></div></div><h3 id="4-define-a-message-to-encode--decode"><span class="mr-2">4. Define a Message to encode / decode</span><a href="#4-define-a-message-to-encode--decode" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>This value is be provided dynamically by the user in the <code class="language-plaintext highlighter-rouge">text</code> field of the HTML:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre>    <span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span>
        <span class="n">div</span> <span class="p">{</span>
            <span class="n">h2</span> <span class="p">{</span>
                <span class="s">"Real-Time Vigénere Cipher"</span>
            <span class="p">}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="nf">input</span><span class="p">(</span><span class="n">placeholder</span><span class="o">=</span><span class="s">"Enter a phrase"</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span><span class="n">value</span><span class="o">=</span><span class="n">name</span><span class="p">)</span> <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>On the <code class="language-plaintext highlighter-rouge">cipher.rs</code> side we will receive that value through the <code class="language-plaintext highlighter-rouge">encode</code> function as defined below.</p><h3 id="5-make-the-key-and-message-have-the-same-size"><span class="mr-2">5. Make the Key and Message have the same size</span><a href="#5-make-the-key-and-message-have-the-same-size" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>A function to adjust the size of a <code class="language-plaintext highlighter-rouge">Key</code> is defined as follows:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Completes the key if the size is not the same as the message.</span>
<span class="k">fn</span> <span class="nf">complete_key</span><span class="p">(</span><span class="n">key</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">msg_size</span><span class="p">:</span> <span class="nb">usize</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">String</span> <span class="p">{</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">key_chars</span> <span class="o">=</span> <span class="n">key</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.cycle</span><span class="p">();</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">new_key</span> <span class="o">=</span> <span class="s">""</span><span class="nf">.to_string</span><span class="p">();</span>
    <span class="k">for</span> <span class="n">_</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">msg_size</span> <span class="p">{</span>
        <span class="n">new_key</span><span class="nf">.push</span><span class="p">(</span><span class="n">key_chars</span><span class="nf">.next</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">());</span>
    <span class="p">}</span>
    <span class="n">new_key</span>
<span class="p">}</span>

</pre></table></code></div></div><p>The interesting part here is again the use of the <a href="https://doc.rust-lang.org/std/iter/struct.Cycle.html">cycle iterator</a>, in order to adjust the size of key as small or as large as the message size.</p><h3 id="6-encode--decode-functions"><span class="mr-2">6. Encode / Decode functions</span><a href="#6-encode--decode-functions" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>Finally comes the actual encryption logic. Let’s start with the <code class="language-plaintext highlighter-rouge">Encode</code> function first:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="c1">// Encodes a message (msg) with a key (key) using a Vigenere Matix (vig_mat).</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">encode</span><span class="p">(</span><span class="n">msg</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">key</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span> <span class="n">vig_mat</span><span class="p">:</span> <span class="n">VigMatrixWrap</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// get size of message and key</span>
    <span class="k">let</span> <span class="n">msg_size</span> <span class="o">=</span> <span class="n">msg</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.count</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">key_size</span> <span class="o">=</span> <span class="n">key</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.count</span><span class="p">();</span>

    <span class="c1">// initializations</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">encrypted_msg</span> <span class="o">=</span> <span class="s">""</span><span class="nf">.to_string</span><span class="p">();</span>
    <span class="c1">// let vig_mat = VigMatrixWrap::new();</span>

    <span class="c1">// if key has a differnt size, then complete it</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">key_e</span> <span class="o">=</span> <span class="n">key</span><span class="nf">.to_string</span><span class="p">();</span>
    <span class="k">if</span> <span class="n">msg_size</span> <span class="o">!=</span> <span class="n">key_size</span> <span class="p">{</span>
        <span class="n">key_e</span> <span class="o">=</span> <span class="nf">complete_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">msg_size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// convert to char vectors</span>
    <span class="k">let</span> <span class="n">key_chars</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">key_e</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">msg_chars</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">msg</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="c1">// encrypt message</span>
    <span class="k">for</span> <span class="n">i</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">msg_size</span> <span class="p">{</span>
        <span class="n">encrypted_msg</span><span class="nf">.push</span><span class="p">(</span><span class="nf">vig_matcher</span><span class="p">(</span><span class="o">&amp;</span><span class="n">vig_mat</span><span class="p">,</span> <span class="n">msg_chars</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">key_chars</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">?</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nf">Ok</span><span class="p">(</span><span class="n">encrypted_msg</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>We define a <code class="language-plaintext highlighter-rouge">function</code> that receives a <code class="language-plaintext highlighter-rouge">message</code>, a <code class="language-plaintext highlighter-rouge">key</code> and a <code class="language-plaintext highlighter-rouge">Vigenére Matrix</code> and returns either a <code class="language-plaintext highlighter-rouge">String</code> with the encrypted message or an <code class="language-plaintext highlighter-rouge">ErrorCode</code>.</p><p>The fine part is the use of another <code class="language-plaintext highlighter-rouge">function</code>, called <code class="language-plaintext highlighter-rouge">vig_matcher</code>:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="c1">// Returns the matching character in the Vigenere matrix, depending</span>
<span class="c1">// on the header (ch_m) and column (ch_k) characters provided</span>
<span class="k">fn</span> <span class="nf">vig_matcher</span><span class="p">(</span><span class="n">m</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">VigMatrixWrap</span><span class="p">,</span> <span class="n">ch_m</span><span class="p">:</span> <span class="nb">char</span><span class="p">,</span> <span class="n">ch_k</span><span class="p">:</span> <span class="nb">char</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">char</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">idx_c</span> <span class="o">=</span> <span class="nf">idx_finder</span><span class="p">(</span><span class="n">ch_m</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">idx_r</span> <span class="o">=</span> <span class="nf">idx_finder</span><span class="p">(</span><span class="n">ch_k</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">m</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>

    <span class="nf">Ok</span><span class="p">(</span><span class="n">m</span><span class="na">.0</span><span class="p">[</span><span class="n">idx_r</span><span class="p">][</span><span class="n">idx_c</span><span class="p">])</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Which actually perform the match of each character between the <code class="language-plaintext highlighter-rouge">Message</code> and the <code class="language-plaintext highlighter-rouge">Key</code> by finding their indices in the <code class="language-plaintext highlighter-rouge">Vigenére Matrix</code> via an <code class="language-plaintext highlighter-rouge">idx_finder</code> function, that either returns an <code class="language-plaintext highlighter-rouge">index</code> for matching or an <code class="language-plaintext highlighter-rouge">ErrorCode</code>:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Returns the index value of a char in the Vigenere matrix.</span>
<span class="k">fn</span> <span class="nf">idx_finder</span><span class="p">(</span><span class="n">ch</span><span class="p">:</span> <span class="nb">char</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">VigMatrixWrap</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">usize</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idx</span><span class="p">,</span> <span class="n">chi</span><span class="p">)</span> <span class="k">in</span> <span class="n">m</span><span class="na">.0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">ch</span> <span class="o">==</span> <span class="o">*</span><span class="n">chi</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="n">idx</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">Err</span><span class="p">(</span><span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidChar</span><span class="p">(</span><span class="n">ch</span><span class="p">))</span>
<span class="p">}</span>

</pre></table></code></div></div><p>And now the <code class="language-plaintext highlighter-rouge">Decode</code> function:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
</pre><td class="rouge-code"><pre><span class="c1">// Decodes an encoded message (enc_msg) with a key (key) and a Vigenere Matrix (vig_mat).</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">decode</span><span class="p">(</span>
    <span class="n">enc_msg</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">vig_mat</span><span class="p">:</span> <span class="n">VigMatrixWrap</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="c1">// get size of message and key</span>
    <span class="k">let</span> <span class="n">msg_size</span> <span class="o">=</span> <span class="n">enc_msg</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.count</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">key_size</span> <span class="o">=</span> <span class="n">key</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.count</span><span class="p">();</span>

    <span class="c1">// initializations</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">decrypted_msg</span> <span class="o">=</span> <span class="s">""</span><span class="nf">.to_string</span><span class="p">();</span>

    <span class="c1">// if key has a differnt size, then complete it</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">key_e</span> <span class="o">=</span> <span class="n">key</span><span class="nf">.to_string</span><span class="p">();</span>
    <span class="k">if</span> <span class="n">msg_size</span> <span class="o">!=</span> <span class="n">key_size</span> <span class="p">{</span>
        <span class="n">key_e</span> <span class="o">=</span> <span class="nf">complete_key</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">msg_size</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="c1">// convert to char vectors</span>
    <span class="k">let</span> <span class="n">key_chars</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">key_e</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>
    <span class="k">let</span> <span class="n">msg_chars</span><span class="p">:</span> <span class="nb">Vec</span><span class="o">&lt;</span><span class="n">_</span><span class="o">&gt;</span> <span class="o">=</span> <span class="n">enc_msg</span><span class="nf">.to_string</span><span class="p">()</span><span class="nf">.chars</span><span class="p">()</span><span class="nf">.collect</span><span class="p">();</span>

    <span class="c1">// decrypt message</span>
    <span class="k">for</span> <span class="n">letter</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">msg_size</span> <span class="p">{</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">msg_idx</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="k">let</span> <span class="n">key_idx</span> <span class="o">=</span> <span class="nf">idx_finder</span><span class="p">(</span><span class="n">key_chars</span><span class="p">[</span><span class="n">letter</span><span class="p">],</span> <span class="o">&amp;</span><span class="n">vig_mat</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
        <span class="k">for</span> <span class="n">c</span> <span class="k">in</span> <span class="mi">0</span><span class="o">..</span><span class="n">vig_mat</span><span class="na">.0</span><span class="nf">.len</span><span class="p">()</span> <span class="p">{</span>
            <span class="k">if</span> <span class="n">vig_mat</span><span class="na">.0</span><span class="p">[</span><span class="n">key_idx</span><span class="p">][</span><span class="n">c</span><span class="p">]</span> <span class="o">==</span> <span class="n">msg_chars</span><span class="p">[</span><span class="n">letter</span><span class="p">]</span> <span class="p">{</span>
                <span class="n">msg_idx</span> <span class="o">=</span> <span class="n">c</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="n">decrypted_msg</span><span class="nf">.push</span><span class="p">(</span><span class="nf">char_finder</span><span class="p">(</span><span class="n">msg_idx</span><span class="p">,</span> <span class="o">&amp;</span><span class="n">vig_mat</span><span class="p">)</span><span class="o">?</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="nf">Ok</span><span class="p">(</span><span class="n">decrypted_msg</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>It’s the reverse substitution from that of <code class="language-plaintext highlighter-rouge">Encode</code> and utilizing a <code class="language-plaintext highlighter-rouge">char_finder</code> function inside the <code class="language-plaintext highlighter-rouge">Vigenére Matrix</code>:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">// Returns the char value of an index in the Vigenere matrix</span>
<span class="k">fn</span> <span class="nf">char_finder</span><span class="p">(</span><span class="n">idx</span><span class="p">:</span> <span class="nb">usize</span><span class="p">,</span> <span class="n">m</span><span class="p">:</span> <span class="o">&amp;</span><span class="n">VigMatrixWrap</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">char</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">idi</span><span class="p">,</span> <span class="n">chi</span><span class="p">)</span> <span class="k">in</span> <span class="n">m</span><span class="na">.0</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="nf">.iter</span><span class="p">()</span><span class="nf">.enumerate</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">idx</span> <span class="o">==</span> <span class="n">idi</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nf">Ok</span><span class="p">(</span><span class="o">*</span><span class="n">chi</span><span class="p">);</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="nf">Err</span><span class="p">(</span><span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidIndex</span><span class="p">(</span><span class="n">idx</span><span class="p">))</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The function returns either the <code class="language-plaintext highlighter-rouge">char</code> or an <code class="language-plaintext highlighter-rouge">ErrorCode</code>.</p><p>The error codes are defined in the following <code class="language-plaintext highlighter-rouge">Enum</code>:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">enum</span> <span class="n">ErrorCode</span> <span class="p">{</span>
    <span class="nf">InvalidChar</span><span class="p">(</span><span class="nb">char</span><span class="p">),</span>
    <span class="nf">InvalidIndex</span><span class="p">(</span><span class="nb">usize</span><span class="p">),</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And that is pretty much all the encoding / decoding logic that is required.</p><p>Now, we just have to connect that logic with the web front-end and user interface elements defined in <code class="language-plaintext highlighter-rouge">main.rs</code>:</p><h2 id="putting-all-together"><span class="mr-2">Putting all together</span><a href="#putting-all-together" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>First declare and initialize the dictionary and the relevant <code class="language-plaintext highlighter-rouge">reactive primitives</code> via <a href="https://sycamore-rs.netlify.app/docs/basics/reactivity#signal">Sycamore signals</a>:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="nd">#[component]</span>
<span class="k">fn</span> <span class="n">App</span><span class="o">&lt;</span><span class="n">G</span><span class="p">:</span> <span class="n">Html</span><span class="o">&gt;</span><span class="p">(</span><span class="n">cx</span><span class="p">:</span> <span class="n">Scope</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">View</span><span class="o">&lt;</span><span class="n">G</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">key</span> <span class="o">=</span> <span class="s">"°¡! RüST íS CóÓL ¡!°"</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">dict</span> <span class="o">=</span> <span class="nn">DictWrap</span><span class="p">::</span><span class="nf">new</span><span class="p">()</span><span class="nf">.get_string</span><span class="p">();</span>

    <span class="c1">// Signals declaration.</span>
    <span class="k">let</span> <span class="n">phrase</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">encr_signal</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">decr_signal</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">warning_signal</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">dict_signal</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">String</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
    <span class="k">let</span> <span class="n">mat_signal</span> <span class="o">=</span> <span class="nf">create_signal</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="nn">VigMatrixWrap</span><span class="p">::</span><span class="nf">new</span><span class="p">());</span>
</pre></table></code></div></div><p>The signals react as follows:</p><ul><li>phrase: when the user modifies the message in the <code class="language-plaintext highlighter-rouge">text</code> HTML field.<li>encr_signal: to display in real-time the encoded message.<li>decr_signal: to display in real-time the decoded message.<li>warning_signal: to display in real-time an error message that comes from the cipher.<li>dict_signal: to display the set of characters that comprise the <code class="language-plaintext highlighter-rouge">dictionary</code>.<li>mat_signal: to create the <code class="language-plaintext highlighter-rouge">Vigenére Matrix</code> that will be used to encode and decode.</ul><p>Next, we create a <a href="https://sycamore-rs.netlify.app/docs/basics/reactivity#memos">Sycamore memo</a> which essentially recomputes derive values whenever a dependency changes. In this case if the <code class="language-plaintext highlighter-rouge">phrase</code> that the user is typing is not empty then we want to encode, decode and alter the signals real-time.</p><p>If it’s empty, then set the encoded, decoded and warning signals empty as well.</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
</pre><td class="rouge-code"><pre>    <span class="c1">// Memo declaration tied to phrase update in the textarea.</span>
    <span class="k">let</span> <span class="n">phrase_update</span> <span class="o">=</span> <span class="nf">create_memo</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">phrase</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="n">encr_signal</span><span class="nf">.set</span><span class="p">(</span><span class="s">""</span><span class="nf">.to_string</span><span class="p">());</span>
            <span class="n">decr_signal</span><span class="nf">.set</span><span class="p">(</span><span class="s">""</span><span class="nf">.to_string</span><span class="p">());</span>
            <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="s">""</span><span class="nf">.to_string</span><span class="p">());</span>
            <span class="n">dict_signal</span><span class="nf">.set</span><span class="p">(</span><span class="n">dict</span><span class="nf">.clone</span><span class="p">());</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="k">match</span> <span class="nf">encode</span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">phrase</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">mat_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="n">ok_phrase</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="n">encr_signal</span><span class="nf">.set</span><span class="p">(</span><span class="n">ok_phrase</span><span class="p">);</span>
                    <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="s">""</span><span class="nf">.to_string</span><span class="p">());</span>
                <span class="p">}</span>
                <span class="nf">Err</span><span class="p">(</span><span class="n">error_kind</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="n">error_kind</span> <span class="p">{</span>
                    <span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidChar</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid character: {}"</span><span class="p">,</span> <span class="n">ic</span><span class="p">))</span>
                    <span class="p">}</span>
                    <span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidIndex</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid index: {}"</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">}</span>
            <span class="k">match</span> <span class="nf">decode</span><span class="p">(</span>
                <span class="o">&amp;</span><span class="n">encr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
                <span class="n">key</span><span class="p">,</span>
                <span class="n">mat_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="p">)</span> <span class="p">{</span>
                <span class="nf">Ok</span><span class="p">(</span><span class="n">ok_phrase</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                    <span class="n">decr_signal</span><span class="nf">.set</span><span class="p">(</span><span class="n">ok_phrase</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="nf">Err</span><span class="p">(</span><span class="n">error_kind</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="k">match</span> <span class="n">error_kind</span> <span class="p">{</span>
                    <span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidChar</span><span class="p">(</span><span class="n">ic</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid character: {}"</span><span class="p">,</span> <span class="n">ic</span><span class="p">))</span>
                    <span class="p">}</span>
                    <span class="nn">ErrorCode</span><span class="p">::</span><span class="nf">InvalidIndex</span><span class="p">(</span><span class="n">ii</span><span class="p">)</span> <span class="k">=&gt;</span> <span class="p">{</span>
                        <span class="n">warning_signal</span><span class="nf">.set</span><span class="p">(</span><span class="nd">format!</span><span class="p">(</span><span class="s">"Invalid index: {}"</span><span class="p">,</span> <span class="n">ii</span><span class="p">))</span>
                    <span class="p">}</span>
                <span class="p">},</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">});</span>
</pre></table></code></div></div><p>If any of the signals has changed, then the display messages need to change accordingly:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre><td class="rouge-code"><pre>    <span class="k">let</span> <span class="n">disp_dict</span> <span class="o">=</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">dict_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="s">""</span><span class="nf">.to_string</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">dict_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">disp_encr</span> <span class="o">=</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">encr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="s">""</span><span class="nf">.to_string</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">encr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">disp_decr</span> <span class="o">=</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">decr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="s">""</span><span class="nf">.to_string</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">decr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">};</span>
    <span class="k">let</span> <span class="n">disp_warning</span> <span class="o">=</span> <span class="p">||</span> <span class="p">{</span>
        <span class="k">if</span> <span class="n">warning_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.is_empty</span><span class="p">()</span> <span class="p">{</span>
            <span class="s">""</span><span class="nf">.to_string</span><span class="p">()</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">warning_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">};</span>
</pre></table></code></div></div><p>Next, we can update the <code class="language-plaintext highlighter-rouge">view!</code> macro to make it a little more attractive with minimum <code class="language-plaintext highlighter-rouge">CSS</code> and use a <code class="language-plaintext highlighter-rouge">textarea</code> for the user input:</p><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre>    <span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span>
        <span class="n">div</span> <span class="p">{</span>
            <span class="n">h1</span> <span class="p">{</span> <span class="s">"Real-Time Vigénere Cipher"</span> <span class="p">}</span>

            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Key: "</span><span class="p">}</span> <span class="s">"["</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:Tomato; font-family:'Courier New';"</span><span class="p">){(</span><span class="n">key</span><span class="p">)}</span> <span class="s">"]"</span> <span class="p">}</span>

            <span class="n">p</span> <span class="p">{</span> <span class="nf">textarea</span><span class="p">(</span><span class="n">placeholder</span><span class="o">=</span><span class="s">"Enter a phrase..."</span><span class="p">,</span> <span class="n">autofocus</span><span class="o">=</span><span class="kc">true</span><span class="p">,</span> <span class="n">maxlength</span><span class="o">=</span><span class="s">"50000"</span><span class="p">,</span> <span class="n">bind</span><span class="p">:</span><span class="n">value</span><span class="o">=</span><span class="n">phrase</span><span class="p">)</span> <span class="p">}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:Tomato"</span><span class="p">){(</span><span class="nf">disp_warning</span><span class="p">())}}</span>

            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Encoded: "</span><span class="p">}</span> <span class="s">"["</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:Tomato; font-family:'Courier New';"</span><span class="p">){(</span><span class="nf">disp_encr</span><span class="p">())}</span> <span class="s">"]"</span> <span class="p">}</span>
            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Decoded: "</span><span class="p">}</span> <span class="s">"["</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:MediumSeaGreen; font-family:'Courier New';"</span><span class="p">){(</span><span class="nf">disp_decr</span><span class="p">())}</span> <span class="s">"]"</span> <span class="p">}</span>


            <span class="n">p</span> <span class="p">{</span> <span class="s">"The encoding dictionary includes the following set of "</span> <span class="p">(</span><span class="n">SIZE</span><span class="p">)</span> <span class="s">" ASCII characters:"</span> <span class="n">br</span><span class="p">{}</span>
              <span class="s">"["</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:Orchid;font-family:'Courier';"</span><span class="p">){(</span><span class="nf">disp_dict</span><span class="p">())}</span> <span class="s">"]"</span> <span class="p">}</span>

            <span class="n">footer</span> <span class="p">{</span>
                <span class="n">small</span><span class="p">{</span><span class="s">"Copyright 2022, "</span> <span class="nf">a</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="s">"https://rsdlt.github.io/about/"</span><span class="p">){</span><span class="s">"Rodrigo Santiago"</span><span class="p">}</span> <span class="s">", "</span> <span class="nf">a</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="s">"https://rsdlt.github.io/about/#terms-of-use"</span><span class="p">){</span><span class="s">"Terms of use"</span><span class="p">}}</span>
               <span class="n">p</span> <span class="p">{</span> <span class="nf">a</span><span class="p">(</span><span class="n">href</span><span class="o">=</span><span class="s">"https://github.com/rsdlt/wasm-vigenere-cipher"</span><span class="p">){</span><span class="s">"GitHub Repo"</span><span class="p">}</span> <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>And we can include a <code class="language-plaintext highlighter-rouge">CSS</code> library, in this case <a href="https://watercss.kognise.dev/">Water.css</a>, and a icon of <a href="https://rustacean.net/">Ferris the crab</a> the <code class="language-plaintext highlighter-rouge">header</code> of our tiny HTML:</p><p><code class="language-plaintext highlighter-rouge">index.html</code></p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="cp">&lt;!DOCTYPE html&gt;</span>
<span class="nt">&lt;html&gt;</span>
  <span class="nt">&lt;head&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">charset=</span><span class="s">"utf-8"</span> <span class="nt">/&gt;</span>
    <span class="nt">&lt;meta</span> <span class="na">name=</span><span class="s">"viewport"</span> <span class="na">content=</span><span class="s">"width=device-width, initial-scale=1.0"</span><span class="nt">&gt;</span> 
    <span class="nt">&lt;title&gt;</span>WebAssembly Vigénere Cipher<span class="nt">&lt;/title&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"stylesheet"</span> <span class="na">href=</span><span class="s">"https://cdn.jsdelivr.net/npm/water.css@2/out/dark.css"</span><span class="nt">&gt;</span>
    <span class="nt">&lt;link</span> <span class="na">rel=</span><span class="s">"icon"</span> <span class="na">data-trunk</span> <span class="na">href=</span><span class="s">"rustacean-flat-happy.svg"</span><span class="nt">&gt;</span>
  <span class="nt">&lt;/head&gt;</span>
  <span class="nt">&lt;body&gt;&lt;/body&gt;</span>
<span class="nt">&lt;/html&gt;</span>
</pre></table></code></div></div><p>When serving with Trunk we see the results in the browser:</p><p><a href="/assets/img/vigenere-cypher-iterators/demo-1.gif" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 824 328'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/demo-1.gif" alt="Vigenère cipher with logic and style" width="824" height="328" class="lazyload" data-proofer-ignore></a> <em>Vigenére cipher working real-time</em></p><p><a href="/assets/img/vigenere-cypher-iterators/demo-2.gif" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 824 328'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/demo-2.gif" alt="Vigenère cipher error handling" width="824" height="328" class="lazyload" data-proofer-ignore></a> <em>Vigenére cipher error handling</em></p><h2 id="final-optimizations"><span class="mr-2">Final optimizations</span><a href="#final-optimizations" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Finally, we can follow <a href="https://sycamore-rs.netlify.app/docs/advanced/optimize_wasm_size">Sycamore recommendations</a> to optimize the Wasm binary size:</p><p><code class="language-plaintext highlighter-rouge">Cargo.toml</code></p><div class="language-toml highlighter-rouge"><div class="code-header"> <span data-label-text="TOML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="nn">[profile.release]</span>
<span class="c"># no backtrace for panic on release</span>
<span class="py">panic</span> <span class="p">=</span> <span class="s">'abort'</span>
<span class="c"># optimize all codegen units</span>
<span class="py">codegen-units</span> <span class="p">=</span> <span class="mi">1</span>
<span class="c"># optimize aggressively for size</span>
<span class="py">opt-level</span> <span class="p">=</span> <span class="s">'z'</span>
<span class="c"># enable link time optimization</span>
<span class="py">lto</span> <span class="p">=</span> <span class="kc">true</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">index.html</code></p><div class="language-html highlighter-rouge"><div class="code-header"> <span data-label-text="HTML"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre>    <span class="nt">&lt;link</span> <span class="na">data-trunk</span> <span class="na">rel=</span><span class="s">"rust"</span> <span class="na">data-wasm-opt=</span><span class="s">"z"</span> <span class="nt">/&gt;</span>
</pre></table></code></div></div><p>And build with <code class="language-plaintext highlighter-rouge">--release</code> flag in Trunk:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="go"> λ trunk build --release
 
2022-09-28T04:35:23.399894Z  INFO  starting build
2022-09-28T04:35:23.400629Z  INFO spawning asset pipelines
2022-09-28T04:35:23.468718Z  INFO copying &amp; hashing icon path="rustacean-flat-happy.svg"
2022-09-28T04:35:23.468734Z  INFO building wasm-vigenere-cipher
2022-09-28T04:35:23.469385Z  INFO finished copying &amp; hashing icon path="rustacean-flat-happy.svg"
   Compiling wasm-vigenere-cipher v0.1.1 (/home/rsdlt/Documents/Rust/wasm/wasm-vigenere-cipher)
    Finished release [optimized] target(s) in 3.33s
2022-09-28T04:35:26.841507Z  INFO fetching cargo artifacts
2022-09-28T04:35:26.909764Z  INFO processing WASM for wasm-vigenere-cipher
2022-09-28T04:35:26.940013Z  INFO using system installed binary app=wasm-bindgen version=0.2.83
2022-09-28T04:35:26.940242Z  INFO calling wasm-bindgen for wasm-vigenere-cipher
2022-09-28T04:35:26.978878Z  INFO copying generated wasm-bindgen artifacts
2022-09-28T04:35:26.980450Z  INFO calling wasm-opt
2022-09-28T04:35:27.575436Z  INFO copying generated wasm-opt artifacts
2022-09-28T04:35:27.576565Z  INFO applying new distribution
2022-09-28T04:35:27.577080Z  INFO  success
</span></pre></table></code></div></div><p>Which yields the following in <code class="language-plaintext highlighter-rouge">/dist/</code> ready to be hosted:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go"> λ la dist
.rw-r--r--  727 rsdlt 28 Sep 00:35  index.html
.rw-r--r-- 7.4k rsdlt 28 Sep 00:35  rustacean-flat-happy-86989a1226cf0803.svg
.rw-r--r--  16k rsdlt 28 Sep 00:35  wasm-vigenere-cipher-5ddca96cbe025f7f.js
.rw-r--r--  81k rsdlt 28 Sep 00:35  wasm-vigenere-cipher-5ddca96cbe025f7f_bg.wasm
</span></pre></table></code></div></div><p>The full web application, including the icon of Ferris the crab, is less than 105kb. Pretty nice!</p><p>And the result is:</p><p><a href="/assets/img/vigenere-cypher-iterators/demo-3.gif" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 912 555'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/demo-3.gif" alt="Vigenère cipher complete" width="912" height="555" class="lazyload" data-proofer-ignore></a> <em>Vigenére cipher complete</em></p><p>I definitely look forward to implementing other Rust projects with <a href="https://sycamore-rs.netlify.app/">Sycamore</a> + <a href="https://trunkrs.dev/">Trunk</a> + <a href="https://webassembly.org/">WebAssembly</a> in the future.</p><p>Don’t forget to check the <a href="https://wasm-vigenere-cipher.onrender.com/">demo</a> and the <a href="https://github.com/rsdlt/wasm-vigenere-cipher">GitHub</a> repository.</p><h2 id="updates-fixes-and-new-features"><span class="mr-2">Updates: fixes and new features</span><a href="#updates-fixes-and-new-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><h3 id="issues-and-bugs"><span class="mr-2">Issues and bugs</span><a href="#issues-and-bugs" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>There was an issue that in some cases yielded an incorrect decoded text. This was because:</p><ul><li>An incorrect number of characters in the <code class="language-plaintext highlighter-rouge">SIZE</code> constant was not updated. The correct number is 192, instead of 225.<li>An erroneous extra space char <code class="language-plaintext highlighter-rouge">' '</code> in the hard-coded dictionary string.</ul><p>The supported list of characters in the dictionary is not affected.</p><p>The issue was corrected in release <a href="https://github.com/rsdlt/wasm-vigenere-cipher/releases/tag/v0.1.2">v0.1.2</a>.</p><h3 id="new-features"><span class="mr-2">New features</span><a href="#new-features" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>In <a href="https://github.com/rsdlt/wasm-vigenere-cipher/releases/tag/v0.1.3">v0.1.3</a> support was added for properly displaying continuous space characters and carriage return / new lines in the decoded text.</p><p>To accomplish it, a new function named <code class="language-plaintext highlighter-rouge">decode_web()</code> was included.</p><p><code class="language-plaintext highlighter-rouge">decode_web</code> calls the original <code class="language-plaintext highlighter-rouge">decode()</code> function, then loops through the text and inserts an <code class="language-plaintext highlighter-rouge">&amp;nbsp;</code> or a <code class="language-plaintext highlighter-rouge">&lt;br&gt;</code> if it finds a space <code class="language-plaintext highlighter-rouge">' '</code> or a <code class="language-plaintext highlighter-rouge">'\r'</code> or <code class="language-plaintext highlighter-rouge">\n</code> characters, respectively:</p><p><code class="language-plaintext highlighter-rouge">src/cipher.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="k">pub</span><span class="p">(</span><span class="k">crate</span><span class="p">)</span> <span class="k">fn</span> <span class="nf">decode_web</span><span class="p">(</span>
    <span class="n">enc_msg</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">key</span><span class="p">:</span> <span class="o">&amp;</span><span class="nb">str</span><span class="p">,</span>
    <span class="n">vig_mat</span><span class="p">:</span> <span class="n">VigMatrixWrap</span><span class="p">,</span>
<span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">Result</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="n">ErrorCode</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">decoded</span> <span class="o">=</span> <span class="nf">decode</span><span class="p">(</span><span class="n">enc_msg</span><span class="p">,</span> <span class="n">key</span><span class="p">,</span> <span class="n">vig_mat</span><span class="p">)</span><span class="o">?</span><span class="p">;</span>
    <span class="k">let</span> <span class="k">mut</span> <span class="n">decoded_web</span> <span class="o">=</span> <span class="s">""</span><span class="nf">.to_string</span><span class="p">();</span>
    <span class="k">for</span> <span class="n">ch</span> <span class="k">in</span> <span class="n">decoded</span><span class="nf">.chars</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">match</span> <span class="n">ch</span> <span class="p">{</span>
            <span class="sc">' '</span> <span class="k">=&gt;</span> <span class="n">decoded_web</span><span class="nf">.push_str</span><span class="p">(</span><span class="s">"&amp;nbsp;"</span><span class="p">),</span>
            <span class="sc">'\n'</span> <span class="p">|</span> <span class="sc">'\r'</span> <span class="k">=&gt;</span> <span class="n">decoded_web</span><span class="nf">.push_str</span><span class="p">(</span><span class="s">"&lt;br&gt;"</span><span class="p">),</span>
            <span class="n">_</span> <span class="k">=&gt;</span> <span class="n">decoded_web</span><span class="nf">.push</span><span class="p">(</span><span class="n">ch</span><span class="p">),</span>
        <span class="p">};</span>
    <span class="p">}</span>
    <span class="nf">Ok</span><span class="p">(</span><span class="n">decoded_web</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And then in <code class="language-plaintext highlighter-rouge">src/main.rs</code>, the following updates were implemented:</p><ul><li>The memo declaration to call for <code class="language-plaintext highlighter-rouge">decode_web()</code> instead of <code class="language-plaintext highlighter-rouge">decode()</code>:</ul><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="c1">// Memo declaration tied to phrase update in the textarea.</span>
<span class="k">let</span> <span class="n">phrase_update</span> <span class="o">=</span> <span class="nf">create_memo</span><span class="p">(</span><span class="n">cx</span><span class="p">,</span> <span class="k">move</span> <span class="p">||</span> <span class="p">{</span>
        <span class="c1">// ..</span>
        <span class="k">match</span> <span class="nf">decode_web</span><span class="p">(</span>
            <span class="o">&amp;</span><span class="n">encr_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
            <span class="n">key</span><span class="p">,</span>
            <span class="n">mat_signal</span><span class="nf">.get</span><span class="p">()</span><span class="nf">.as_ref</span><span class="p">()</span><span class="nf">.clone</span><span class="p">(),</span>
        <span class="p">)</span> <span class="p">{</span>
        <span class="c1">// ..</span>
<span class="p">});</span>
</pre></table></code></div></div><ul><li>The <code class="language-plaintext highlighter-rouge">view!</code> macro to properly display the HTML escape characters by using Sycamore’s <a href="https://sycamore-rs.netlify.app/docs/basics/view#dangerously_set_inner_html">dangerously_set_inner_html</a> special attribute:</ul><p><code class="language-plaintext highlighter-rouge">src/main.rs</code></p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="nd">view!</span> <span class="p">{</span> <span class="n">cx</span><span class="p">,</span>
        <span class="n">div</span> <span class="p">{</span>
            <span class="c1">// ..</span>
            <span class="n">p</span> <span class="p">{</span> <span class="n">strong</span><span class="p">{</span><span class="s">"Decoded: "</span><span class="p">}</span> <span class="n">br</span><span class="p">{}</span>
                <span class="s">"["</span> <span class="nf">span</span><span class="p">(</span><span class="n">style</span><span class="o">=</span><span class="s">"color:MediumSeaGreen; font-family:'Courier New';"</span><span class="p">){</span><span class="nf">span</span><span class="p">(</span><span class="n">dangerously_set_inner_html</span><span class="o">=&amp;</span><span class="p">(</span><span class="nf">disp_decr</span><span class="p">()))}</span> <span class="s">"]"</span> <span class="p">}</span>
            <span class="c1">// ..</span>
    <span class="p">}</span>
</pre></table></code></div></div><p>After applying these changes this is the result:</p><p><a href="/assets/img/vigenere-cypher-iterators/demo-4.gif" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 837 518'%3E%3C/svg%3E" data-src="/assets/img/vigenere-cypher-iterators/demo-4.gif" alt="Vigenère cipher properly showing spaces" width="837" height="518" class="lazyload" data-proofer-ignore></a> <em>Vigenére cipher with better space char and new line display</em></p><hr /><p><strong><em>Links, references, and disclaimers:</em></strong></p><ul><li><p><strong>Disclaimer:</strong> I am not affiliated, associated, endorsed or sponsored by any the authors or developers of these libraries, books, or courses.</p><li><a href="https://www.rust-lang.org/">Rust</a> programming language.<li><a href="https://sycamore-rs.netlify.app/">Sycamore</a> reactive library.<li><a href="https://trunkrs.dev/">Trunk</a> WASM web application bundler.<li><a href="https://webassembly.org/">WASM</a> WebAssembly binary instruction format.<li><a href="https://www.ecma-international.org/publications-and-standards/standards/ecma-262/">JavaScript</a> programming language.<li>Tim McNamara’s <a href="https://www.linkedin.com/learning/rust-code-challenges/let-s-put-rust-into-practice?autoplay=true">Rust Code Challenges</a>.<li><a href="https://en.wikipedia.org/wiki/Vigen%C3%A8re_cipher">Vigenère cipher</a> Wikipedia article.<li><a href="https://en.wikipedia.org/wiki/Substitution_cipher">substitution</a> - Substitution cipher Wikipedia article.<li><a href="http://127.0.0.1:4000/posts/vigenere-cypher-wasm-rust-iterator-function/">MDN Web Docs</a> the Mozilla Dev Network Documentation.<li><a href="https://rustacean.net/">Ferris the crab</a> a lovely mascot.<li><a href="https://watercss.kognise.dev/">Water.css</a> a drop-in collection of CSS styles.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a>, <a href='/categories/wasm/'>Wasm</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a> <a href="/tags/array/" class="post-tag no-text-decoration" >array</a> <a href="/tags/wasm/" class="post-tag no-text-decoration" >wasm</a> <a href="/tags/iterators/" class="post-tag no-text-decoration" >iterators</a> <a href="/tags/webassembly/" class="post-tag no-text-decoration" >webassembly</a> <a href="/tags/sycamore/" class="post-tag no-text-decoration" >sycamore</a> <a href="/tags/trunk/" class="post-tag no-text-decoration" >trunk</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author. <br />Source code samples licensed under <a href="https://mit-license.org/">MIT<a> or <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache-2.0<a></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Building%20a%20Real-Time%20Web%20Cipher%20with%20Rust,%20Sycamore%20and%20Trunk%20-%20the%20trait&url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-sycamore-trunk-wasm-iterators-vigenere-cipher%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Building%20a%20Real-Time%20Web%20Cipher%20with%20Rust,%20Sycamore%20and%20Trunk%20-%20the%20trait&u=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-sycamore-trunk-wasm-iterators-vigenere-cipher%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-sycamore-trunk-wasm-iterators-vigenere-cipher%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/rust-nvim-ide-guide-walkthrough-development-debug/">Rust and Neovim - A Thorough Guide and Walkthrough</a><li><a href="/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/">Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</a><li><a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/">Implementing the Display Trait on a Generic Array using Newtype Pattern</a><li><a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/">Ruxel - Building a Ray Tracer with Rust Part 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/"><div class="card-body"> <em class="small" data-ts="1663409700" data-df="ll" > Sep 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Implementing the Display Trait on a Generic Array using Newtype Pattern</h3><div class="text-muted small"><p> Edit: In the original post I said that the PartialEq trait bound was required in the generic Display function implementation; however, if the last element of the array is the same as its predece...</p></div></div></a></div><div class="card"> <a href="/posts/welcome-blog-rust-technology-development-programming-language/"><div class="card-body"> <em class="small" data-ts="1659846120" data-df="ll" > Aug 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic Operator Overloading with Traits</h3><div class="text-muted small"><p> In this post I want to share one of my favorite characteristics about Rust: how it provides the capability to overload an operator to support arithmetic (and other) operations on our own user-defin...</p></div></div></a></div><div class="card"> <a href="/posts/ruxel-ray-tracer-project-first-update-rust-programming-development/"><div class="card-body"> <em class="small" data-ts="1660095300" data-df="ll" > Aug 9, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruxel - Building a Ray Tracer with Rust (Prelude)</h3><div class="text-muted small"><p> As far back as I can remember I have always been fascinated by 3D graphics. And building a Ray Tracer and Renderer seems like a fantastic project to sharpen my skills with Rust. So I have embarked...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/" class="btn btn-outline-primary" prompt="Older"><p>Implementing the Display Trait on a Generic Array using Newtype Pattern</p></a><div class="btn btn-outline-primary disabled" prompt="Newer"><p>-</p></div></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/rsdlt">Rodrigo Santiago</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."><br />Use of this site is subject to our <a href="/about/#terms-of-use">Terms of Use.<a></span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4YJ2815MJ6"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4YJ2815MJ6'); }); </script>

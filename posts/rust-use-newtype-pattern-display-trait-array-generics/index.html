<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="Implementing the Display Trait on a Generic Array using Newtype Pattern" /><meta name="author" content="rsdlt" /><meta property="og:locale" content="en" /><meta name="description" content="Edit: In the original post I said that the PartialEq trait bound was required in the generic Display function implementation; however, if the last element of the array is the same as its predecessor then the function will not print properly. Thanks to korrat for letting me know and for the recommendation to use std::ptr::eq instead." /><meta property="og:description" content="Edit: In the original post I said that the PartialEq trait bound was required in the generic Display function implementation; however, if the last element of the array is the same as its predecessor then the function will not print properly. Thanks to korrat for letting me know and for the recommendation to use std::ptr::eq instead." /><link rel="canonical" href="https://rsdlt.github.io/posts/rust-use-newtype-pattern-display-trait-array-generics/" /><meta property="og:url" content="https://rsdlt.github.io/posts/rust-use-newtype-pattern-display-trait-array-generics/" /><meta property="og:site_name" content="the trait" /><meta property="og:image" content="https://rsdlt.github.io/assets/img/newtype-pattern-array-generics-display-trait/faris-mohammed-PQinRWK1TgU-unsplash.jpg" /><meta property="og:image:height" content="606" /><meta property="og:image:width" content="1200" /><meta property="og:image:alt" content="Photo by Faris Mohammed via Unsplash" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-17T06:15:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://rsdlt.github.io/assets/img/newtype-pattern-array-generics-display-trait/faris-mohammed-PQinRWK1TgU-unsplash.jpg" /><meta name="twitter:image:alt" content="Photo by Faris Mohammed via Unsplash" /><meta property="twitter:title" content="Implementing the Display Trait on a Generic Array using Newtype Pattern" /><meta name="twitter:site" content="@_rsdlt" /><meta name="twitter:creator" content="@rsdlt" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"rsdlt"},"dateModified":"2022-09-27T09:41:22-04:00","datePublished":"2022-09-17T06:15:00-04:00","description":"Edit: In the original post I said that the PartialEq trait bound was required in the generic Display function implementation; however, if the last element of the array is the same as its predecessor then the function will not print properly. Thanks to korrat for letting me know and for the recommendation to use std::ptr::eq instead.","headline":"Implementing the Display Trait on a Generic Array using Newtype Pattern","image":{"width":1200,"height":606,"alt":"Photo by Faris Mohammed via Unsplash","url":"https://rsdlt.github.io/assets/img/newtype-pattern-array-generics-display-trait/faris-mohammed-PQinRWK1TgU-unsplash.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rsdlt.github.io/posts/rust-use-newtype-pattern-display-trait-array-generics/"},"url":"https://rsdlt.github.io/posts/rust-use-newtype-pattern-display-trait-array-generics/"}</script><title>Implementing the Display Trait on a Generic Array using Newtype Pattern | the trait</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="the trait"><meta name="application-name" content="the trait"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/rsdlt_bw.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">the trait</a></div><div class="site-subtitle font-italic">Rodrigo Santiago</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rsdlt" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['rsdlt','pm.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/rsdlt/" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>Implementing the Display Trait on a Generic Array using Newtype Pattern</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>Implementing the Display Trait on a Generic Array using Newtype Pattern</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1663409700" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 17, 2022 </em> </span> <span> Updated <em class="" data-ts="1664286082" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 27, 2022 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/newtype-pattern-array-generics-display-trait/faris-mohammed-PQinRWK1TgU-unsplash.jpg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/newtype-pattern-array-generics-display-trait/faris-mohammed-PQinRWK1TgU-unsplash.jpg" alt="Photo by Faris Mohammed via Unsplash" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">Photo by Faris Mohammed via Unsplash</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2315 words"> <em>12 min</em> read</span></div></div></div><div class="post-content"><blockquote class="prompt-info"><p><strong>Edit:</strong> In the original post I said that the <em>PartialEq</em> trait bound was required in the generic <em>Display</em> function implementation; however, if the last element of the array is the same as its predecessor then the function will not print properly. Thanks to <a href="https://github.com/korrat/">korrat</a> for letting me know and for the recommendation to use <em>std::ptr::eq</em> instead.</p></blockquote><p>Probably one of the first things that someone does when learning a new programming language is to implement the famous <code class="language-plaintext highlighter-rouge">"Hello, world!"</code> message, which in the case of <a href="https://www.rust-lang.org">Rust</a> comes with the boilerplate code via the <code class="language-plaintext highlighter-rouge">cargo new</code> command:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"Hello, world!"</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And then, start experimenting on how to display different <code class="language-plaintext highlighter-rouge">types</code> in the terminal, like <code class="language-plaintext highlighter-rouge">strings</code>, <code class="language-plaintext highlighter-rouge">integers</code>, <code class="language-plaintext highlighter-rouge">floats</code>, etc.:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">planet</span> <span class="o">=</span> <span class="s">"Earth"</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">surface_area</span> <span class="o">=</span> <span class="mi">510072000</span><span class="p">;</span>
    <span class="k">let</span> <span class="n">polar_radius</span> <span class="o">=</span> <span class="mf">6356.752</span><span class="p">;</span>
    <span class="nd">println!</span><span class="p">(</span>
        <span class="s">"Hello, {}!</span><span class="se">\n</span><span class="s">Surface area: {}</span><span class="se">\n</span><span class="s">Polar radius: {}"</span><span class="p">,</span>
        <span class="n">planet</span><span class="p">,</span> <span class="n">surface_area</span><span class="p">,</span> <span class="n">polar_radius</span>
    <span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
Hello, Earth!
Surface area: 510072000
Polar radius: 6356.752
</span></pre></table></code></div></div><p>In Rust it’s pretty straightforward until we try to print a <code class="language-plaintext highlighter-rouge">struct</code> or other user-defined types:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">surface_area</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">polar_radius</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">planet</span> <span class="o">=</span> <span class="n">Planet</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s">"Earth"</span><span class="nf">.to_string</span><span class="p">(),</span>
        <span class="n">surface_area</span><span class="p">:</span> <span class="mi">510072000</span><span class="p">,</span>
        <span class="n">polar_radius</span><span class="p">:</span> <span class="mf">6356.752</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">planet</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The compiler yields an error and advice:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go"> λ cargo run -q
error[E0277]: `Planet` doesn't implement `std::fmt::Display`
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/main.rs:20:20
<span class="go">   |
</span><span class="gp">20 |     println!("{}", planet);</span><span class="w">
</span><span class="go">   |                    ^^^^^^ `Planet` cannot be formatted with the default formatter
   |
   = help: the trait `std::fmt::Display` is not implemented for `Planet`
</span><span class="gp">   = note: in format strings you may be able to use `{:?}` (or {:#</span>?<span class="o">}</span> <span class="k">for </span>pretty-print<span class="o">)</span> instead
<span class="gp">   = note: this error originates in the macro `$</span>crate::format_args_nl<span class="sb">`</span> <span class="o">(</span><span class="k">in </span>Nightly builds, run with <span class="nt">-Z</span> macro-backtrace <span class="k">for </span>more info<span class="o">)</span>
<span class="go">
For more information about this error, try `rustc --explain E0277`.
error: could not compile `temp` due to previous error
</span></pre></table></code></div></div><p>What’s happening here?</p><h2 id="the-debug-and-display-traits"><span class="mr-2">The Debug and Display traits</span><a href="#the-debug-and-display-traits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The compiler is basically saying that it doesn’t know how to print the <code class="language-plaintext highlighter-rouge">struct Planet</code> type.</p><p>However, it’s providing two alternatives:</p><ol><li>Use the built-in formatters with <code class="language-plaintext highlighter-rouge">{:?}</code> or <code class="language-plaintext highlighter-rouge">{:#?}</code> in the <code class="language-plaintext highlighter-rouge">println!</code> macro, which requires implementing the <code class="language-plaintext highlighter-rouge">Debug</code> trait on the <code class="language-plaintext highlighter-rouge">struct Planet</code> type, or<li>Implement the <code class="language-plaintext highlighter-rouge">std::fmt::Display</code> trait and define the formatter for the type.</ol><p>Let’s review both alternatives in more detail.</p><p>First, the <code class="language-plaintext highlighter-rouge">Debug</code> trait can be implemented using the <code class="language-plaintext highlighter-rouge">#[derive(Debug)]</code> attribute:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre><td class="rouge-code"><pre><span class="nd">#[derive(Debug)]</span>
<span class="k">struct</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">surface_area</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">polar_radius</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">planet</span> <span class="o">=</span> <span class="n">Planet</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s">"Earth"</span><span class="nf">.to_string</span><span class="p">(),</span>
        <span class="n">surface_area</span><span class="p">:</span> <span class="mi">510072000</span><span class="p">,</span>
        <span class="n">polar_radius</span><span class="p">:</span> <span class="mf">6356.752</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">planet</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{:#?}"</span><span class="p">,</span> <span class="n">planet</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And when running the program, the <code class="language-plaintext highlighter-rouge">struct Planet</code> type is printed using the built-in formatters provided by the <code class="language-plaintext highlighter-rouge">Debug</code> trait:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
Planet { name: "Earth", surface_area: 510072000, polar_radius: 6356.752 }
Planet {
    name: "Earth",
    surface_area: 510072000,
    polar_radius: 6356.752,
}
</span></pre></table></code></div></div><p>On the other hand, implementing the <code class="language-plaintext highlighter-rouge">Display</code> trait isn’t as straightforward as <code class="language-plaintext highlighter-rouge">Debug</code>, but can be accomplished by bringing <code class="language-plaintext highlighter-rouge">std::fmt::Display</code> into scope and writing an <code class="language-plaintext highlighter-rouge">impl</code> block for the <code class="language-plaintext highlighter-rouge">struct Planet</code> type, which defines the custom formatter in the <code class="language-plaintext highlighter-rouge">fn fmt(...)</code> function:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="n">name</span><span class="p">:</span> <span class="nb">String</span><span class="p">,</span>
    <span class="n">surface_area</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">polar_radius</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Planet</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="nd">write!</span><span class="p">(</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="s">"-&gt; {}:</span><span class="se">\n\t</span><span class="s">Surface: {} km2</span><span class="se">\n\t</span><span class="s">Polar radius: {} km"</span><span class="p">,</span>
            <span class="k">self</span><span class="py">.name</span><span class="p">,</span> <span class="k">self</span><span class="py">.surface_area</span><span class="p">,</span> <span class="k">self</span><span class="py">.polar_radius</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">planet</span> <span class="o">=</span> <span class="n">Planet</span> <span class="p">{</span>
        <span class="n">name</span><span class="p">:</span> <span class="s">"Earth"</span><span class="nf">.to_string</span><span class="p">(),</span>
        <span class="n">surface_area</span><span class="p">:</span> <span class="mi">510072000</span><span class="p">,</span>
        <span class="n">polar_radius</span><span class="p">:</span> <span class="mf">6356.752</span><span class="p">,</span>
    <span class="p">};</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">planet</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Implementing <code class="language-plaintext highlighter-rouge">Display</code> allows the definition of a custom printing format for the type:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
</span><span class="gp">-&gt;</span><span class="w"> </span>Earth:
<span class="go">	Surface: 510072000 km2
	Polar radius: 6356.752 km
</span></pre></table></code></div></div><h2 id="arrays-and-the-orphan-rule"><span class="mr-2">Arrays and the ‘Orphan Rule’</span><a href="#arrays-and-the-orphan-rule" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Now, let’s try to follow the same steps but with an <code class="language-plaintext highlighter-rouge">Array</code>…</p><p>First, by defining an array of four <code class="language-plaintext highlighter-rouge">f64</code> elements and trying to print it with <code class="language-plaintext highlighter-rouge">println!</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">f64</span><span class="p">;</span> <span class="mi">4</span><span class="p">];</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array</span><span class="p">:</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">];</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_array</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The compiler yields the same error code and advice for the <code class="language-plaintext highlighter-rouge">Array</code> type, just as it did for the <code class="language-plaintext highlighter-rouge">struct</code> type:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="go"> λ cargo run -q
</span><span class="gp">error[E0277]: `[f64;</span><span class="w"> </span>4]<span class="sb">`</span> doesn<span class="s1">'t implement `std::fmt::Display`
</span><span class="gp">  --&gt;</span><span class="w"> </span><span class="s1">src/main.rs:25:20
</span><span class="go">   |
</span><span class="gp">25 |     println!("{}", my_array);</span><span class="w">
</span><span class="gp">   |                    ^^^^^^^^ `[f64;</span><span class="w"> </span>4]<span class="sb">`</span> cannot be formatted with the default formatter
<span class="go">   |
</span><span class="gp">   = help: the trait `std::fmt::Display` is not implemented for `[f64;</span><span class="w"> </span>4]<span class="sb">`</span>
<span class="gp">   = note: in format strings you may be able to use `{:?}` (or {:#</span>?<span class="o">}</span> <span class="k">for </span>pretty-print<span class="o">)</span> instead
<span class="gp">   = note: this error originates in the macro `$</span>crate::format_args_nl<span class="sb">`</span> <span class="o">(</span><span class="k">in </span>Nightly builds, run with <span class="nt">-Z</span> macro-backtrace <span class="k">for </span>more info<span class="o">)</span>
<span class="go">
For more information about this error, try `rustc --explain E0277`.
</span></pre></table></code></div></div><p>Following the compiler’s guidance and using the built-in <code class="language-plaintext highlighter-rouge">"{:?}"</code> and <code class="language-plaintext highlighter-rouge">"{:#?}"</code> formatters works, just like with the <code class="language-plaintext highlighter-rouge">struct</code> type, and the array is printed:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre><td class="rouge-code"><pre><span class="go"> λ cargo run -q
[1.5, 2.5, 3.5, 4.5]
[
    1.5,
    2.5,
    3.5,
    4.5,
]
</span></pre></table></code></div></div><p>Great!</p><p>Now, let’s try to define a custom formatter via the <code class="language-plaintext highlighter-rouge">Display</code> trait for the <code class="language-plaintext highlighter-rouge">Array</code> type, just as we did with the <code class="language-plaintext highlighter-rouge">struct</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">f64</span><span class="p">;</span> <span class="mi">4</span><span class="p">];</span>

<span class="k">impl</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">MyArray</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="nd">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">"{}, {}, {}, {}"</span><span class="p">,</span> <span class="k">self</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">self</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">self</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">self</span><span class="p">[</span><span class="mi">3</span><span class="p">])</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array</span><span class="p">:</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">];</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_array</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="go"> λ cargo run -q
error[E0117]: only traits defined in the current crate can be implemented for arbitrary types
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/main.rs:25:1
<span class="go">   |
25 | impl Display for MyArray {
   | ^^^^^^^^^^^^^^^^^-------
   | |                |
   | |                this is not defined in the current crate because arrays are always foreign
   | impl doesn't use only types from inside the current crate
   |
   = note: define and implement a trait or new type instead

For more information about this error, try `rustc --explain E0117`.
</span></pre></table></code></div></div><p>Ups! Unfortunately, this doesn’t work like it did with the <code class="language-plaintext highlighter-rouge">struct</code> type.</p><p>Looking closely at the compiler feedback, it’s complaining that <strong>arrays are always foreign types</strong>.</p><p>If we run <code class="language-plaintext highlighter-rouge">rustc --explain E0117</code> the compiler provides additional details about what is happening here:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="go">This error indicates a violation of one of Rust's orphan rules for trait
implementations. The rule prohibits any implementation of a foreign trait (a
trait defined in another crate) where

 - the type that is implementing the trait is foreign
 - all of the parameters being passed to the trait (if there are any) are also
   foreign.

To avoid this kind of error, ensure that at least one local type is referenced
by the `impl`...
</span></pre></table></code></div></div><p>It turns out that by implementing <code class="language-plaintext highlighter-rouge">Display</code> on any <code class="language-plaintext highlighter-rouge">Array</code> we’re violating Rust’s <strong>Orphan Rule</strong> which essentially forbid implementing a foreign trait on a foreign type.</p><p>A <strong>foreign</strong> type or trait is that which isn’t local to our crate.</p><p>A <strong>local</strong> type or trait is that which is defined in our crate.</p><p>So, to overcome the <em>Orphan Rule</em> we must either:</p><ul><li>Implement a local trait on a foreign type: <code class="language-plaintext highlighter-rouge">impl MyCustomTrait for Vec&lt;T&gt;</code>, or<li>Implement a foreign trait on a local type: <code class="language-plaintext highlighter-rouge">impl Display for MyStruct</code>.</ul><p>Because the <code class="language-plaintext highlighter-rouge">struct Planet</code> was a type defined in our crate we were able to implement <code class="language-plaintext highlighter-rouge">Display</code>, a foreign trait, for it.</p><p>However, even if we define an <code class="language-plaintext highlighter-rouge">Array</code> in our crate, like we did with <code class="language-plaintext highlighter-rouge">MyArray</code> above, Rust will always treat arrays as a foreign type.</p><p><code class="language-plaintext highlighter-rouge">Display</code> will always be a <em>foreign trait</em> and any <code class="language-plaintext highlighter-rouge">Array</code> that we define locally in our crate will always be a <em>foreign type</em>…</p><p>What can be done?</p><h2 id="the-newtype-pattern-to-the-rescue"><span class="mr-2">The Newtype Pattern to the rescue</span><a href="#the-newtype-pattern-to-the-rescue" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>According to the <a href="https://doc.rust-lang.org/stable/book/ch19-03-advanced-traits.html#using-the-newtype-pattern-to-implement-external-traits-on-external-types">Rust Programming Language book</a>, the <code class="language-plaintext highlighter-rouge">Newtype pattern</code> comes from the <a href="https://wiki.haskell.org/Newtype">Haskell Programming Language Newtype</a>, and the idea is to essentially define a <strong>local wrapper type</strong> that encloses the <code class="language-plaintext highlighter-rouge">foreign type</code> in order to implement the <code class="language-plaintext highlighter-rouge">foreign trait</code> for the wrapper.</p><p>So, in a summary:</p><ul><li>Define a <em>new</em> <code class="language-plaintext highlighter-rouge">Wrapper</code> type local to the crate.<li>Include the <code class="language-plaintext highlighter-rouge">foreign type</code> as an element of the <code class="language-plaintext highlighter-rouge">Wrapper</code> type.<li>Implement the <code class="language-plaintext highlighter-rouge">foreign trait</code> for the <code class="language-plaintext highlighter-rouge">Wrapper</code> type.</ul><p>One convenient approach is to use a <em>thin wrapper</em>, that’s a <code class="language-plaintext highlighter-rouge">Wrapper type</code> that provides a straightforward way to get to the enclosed or <code class="language-plaintext highlighter-rouge">wrapped type</code> with minimum friction.</p><p>A <code class="language-plaintext highlighter-rouge">Tuple Struct</code> is a suitable <em>thin wrapper</em> type:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">f64</span><span class="p">;</span> <span class="mi">4</span><span class="p">];</span>

<span class="k">struct</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">MyArray</span><span class="p">);</span>
</pre></table></code></div></div><p>It’s not verbose, not redundant and allows a straightforward access to the underlying type with <code class="language-plaintext highlighter-rouge">wrap.0</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array</span><span class="p">:</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{:?}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="na">.0</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
[1.5, 2.5, 3.5, 4.5]
</span></pre></table></code></div></div><p>Now it’s possible to implement the <em>foreign</em> <code class="language-plaintext highlighter-rouge">Display</code> trait for the <em>local</em> <code class="language-plaintext highlighter-rouge">Wrap</code> type that encloses the <em>foreign</em> <code class="language-plaintext highlighter-rouge">Array</code> type:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="nb">f64</span><span class="p">;</span> <span class="mi">4</span><span class="p">];</span>

<span class="k">struct</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">MyArray</span><span class="p">);</span>

<span class="k">impl</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Wrap</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="nd">write!</span><span class="p">(</span>
            <span class="n">f</span><span class="p">,</span>
            <span class="s">"-&gt; Array:</span><span class="se">\n</span><span class="s">{}, {}, {}, {}"</span><span class="p">,</span>
            <span class="k">self</span><span class="na">.0</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="k">self</span><span class="na">.0</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="k">self</span><span class="na">.0</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="k">self</span><span class="na">.0</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array</span><span class="p">:</span> <span class="n">MyArray</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="p">)</span>
<span class="p">}</span>
</pre></table></code></div></div><p>When the program is executed, the custom format for the <code class="language-plaintext highlighter-rouge">Array</code> type is used via the <code class="language-plaintext highlighter-rouge">Display</code> trait:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
</span><span class="gp">-&gt;</span><span class="w"> </span>Array:
<span class="go">1.5, 2.5, 3.5, 4.5
</span></pre></table></code></div></div><p>This code works well but is rather limited to:</p><ul><li>A single data type: <code class="language-plaintext highlighter-rouge">f64</code>.<li>An array of size <code class="language-plaintext highlighter-rouge">4</code>.<li>One <code class="language-plaintext highlighter-rouge">Array</code> type.</ul><p>It’s possible to leverage Rust’s generics to make it more <em>extendable</em> and <em>idiomatic</em>.</p><h2 id="extensibility-with-generics"><span class="mr-2">Extensibility with Generics</span><a href="#extensibility-with-generics" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>The first thing to do is make <code class="language-plaintext highlighter-rouge">Array</code> a generic type:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span><span class="n">T</span><span class="p">;</span> <span class="n">N</span><span class="p">];</span>
</pre></table></code></div></div><p>However, the code above will fail to compile because ‘N’, which represents the size of the array, isn’t a value:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre><td class="rouge-code"><pre><span class="go">error[E0423]: expected value, found type parameter `N`
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/main.rs:22:26
<span class="go">   |
</span><span class="gp">22 | type MyArray&lt;T, N&gt;</span><span class="w"> </span><span class="o">=</span> <span class="o">[</span>T<span class="p">;</span> N]<span class="p">;</span>
<span class="go">   |                          ^ not a value
</span></pre></table></code></div></div><p>It’s necessary to use Rust’s <a href="https://rust-lang.github.io/rfcs/2000-const-generics.html">Const Generics</a> in order to make the array completely generic, as per the RFC definition:</p><blockquote><p><em>Const Generics allow types to be generic over constant values; among other things this will allow users to write impls which are abstract over all array types.</em></p></blockquote><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">type</span> <span class="n">MyArray</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="o">=</span> <span class="p">[</span><span class="n">T</span><span class="p">;</span> <span class="n">N</span><span class="p">];</span>
</pre></table></code></div></div><p>And now, it’s possible to make the <code class="language-plaintext highlighter-rouge">Wrap</code> type generic as well:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span><span class="p">(</span><span class="n">MyArray</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span><span class="p">);</span>
</pre></table></code></div></div><p>Next, we need to make the <code class="language-plaintext highlighter-rouge">impl</code> of <code class="language-plaintext highlighter-rouge">Display</code> generic for arrays of any type and of any size, by declaring the <code class="language-plaintext highlighter-rouge">impl</code> with the same generics as those of the Wrap:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre><td class="rouge-code"><pre><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>
</pre></table></code></div></div><p>Then it’s necessary to bound the <code class="language-plaintext highlighter-rouge">Array</code> type to those types that implement the <code class="language-plaintext highlighter-rouge">Display</code> trait, plus any other trait that’s required for our particular implementation:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre><td class="rouge-code"><pre><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="n">Display</span><span class="p">,</span>
</pre></table></code></div></div><p>In this particular case, <span style="text-decoration: line-through;">the bound with the <code class="language-plaintext highlighter-rouge">PartialEq</code> trait is required because I’m making an equality comparison between elements of the array.</span> (As pointed by <a href="https://github.com/korrat/">korrat</a>, it’s better to use <code class="language-plaintext highlighter-rouge">std::ptr::eq</code> as the comparison function between the references in order to avoid the incorrect printing if the last element of the array is the same as its predecessor.)</p><p>Last thing to do is to implement the required <code class="language-plaintext highlighter-rouge">Display</code> trait function: <code class="language-plaintext highlighter-rouge">fn fmt(...) -&gt; std::fmt::Result</code>, with the desired custom formatter:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre><td class="rouge-code"><pre><span class="k">use</span> <span class="nn">core</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Display</span><span class="p">;</span>
<span class="k">use</span> <span class="nn">std</span><span class="p">::</span><span class="nn">ptr</span><span class="p">::</span><span class="n">eq</span><span class="p">;</span>

<span class="k">struct</span> <span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span><span class="p">([</span><span class="n">T</span><span class="p">;</span> <span class="n">N</span><span class="p">]);</span>

<span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="k">const</span> <span class="n">N</span><span class="p">:</span> <span class="nb">usize</span><span class="o">&gt;</span> <span class="n">Display</span> <span class="k">for</span> <span class="n">Wrap</span><span class="o">&lt;</span><span class="n">T</span><span class="p">,</span> <span class="n">N</span><span class="o">&gt;</span>
<span class="k">where</span>
    <span class="n">T</span><span class="p">:</span> <span class="n">Display</span><span class="p">,</span>
<span class="p">{</span>
    <span class="k">fn</span> <span class="nf">fmt</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">,</span> <span class="n">f</span><span class="p">:</span> <span class="o">&amp;</span><span class="k">mut</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="n">Formatter</span><span class="o">&lt;</span><span class="nv">'_</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nn">std</span><span class="p">::</span><span class="nn">fmt</span><span class="p">::</span><span class="nb">Result</span> <span class="p">{</span>
        <span class="k">let</span> <span class="n">separator</span> <span class="o">=</span> <span class="s">", "</span><span class="p">;</span>
        <span class="k">let</span> <span class="k">mut</span> <span class="n">s</span> <span class="o">=</span> <span class="s">"Array -&gt; "</span><span class="nf">.to_string</span><span class="p">();</span>

        <span class="k">for</span> <span class="n">element</span> <span class="k">in</span> <span class="o">&amp;</span><span class="k">self</span><span class="na">.0</span> <span class="p">{</span>
            <span class="n">s</span><span class="nf">.push_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">element</span><span class="nf">.to_string</span><span class="p">());</span>
            <span class="k">if</span> <span class="o">!</span><span class="nf">eq</span><span class="p">(</span><span class="n">element</span><span class="p">,</span> <span class="k">self</span><span class="na">.0</span><span class="nf">.last</span><span class="p">()</span><span class="nf">.unwrap</span><span class="p">())</span> <span class="p">{</span>
                <span class="n">s</span><span class="nf">.push_str</span><span class="p">(</span><span class="o">&amp;</span><span class="n">separator</span><span class="p">);</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="nd">write!</span><span class="p">(</span><span class="n">f</span><span class="p">,</span> <span class="s">"{}"</span><span class="p">,</span> <span class="n">s</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array</span> <span class="o">=</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="mi">1</span><span class="p">];</span>

    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="p">);</span>
<span class="p">}</span>

</pre></table></code></div></div><p>Finally!</p><p>It’s now possible to define an <code class="language-plaintext highlighter-rouge">Array</code> of any size and of any type, so long as that type implements <code class="language-plaintext highlighter-rouge">Display</code>, and print it using the <code class="language-plaintext highlighter-rouge">println!</code> macro with a custom formatter:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre><td class="rouge-code"><pre><span class="k">fn</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">let</span> <span class="n">my_array_f</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.5</span><span class="p">,</span> <span class="mf">2.5</span><span class="p">,</span> <span class="mf">3.5</span><span class="p">,</span> <span class="mf">4.5</span><span class="p">,</span> <span class="mf">5.2</span><span class="p">,</span> <span class="mf">6.75</span><span class="p">,</span> <span class="mf">8.90</span><span class="p">,</span> <span class="mf">8.90</span><span class="p">,</span> <span class="mf">8.90</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">my_array_c</span> <span class="o">=</span> <span class="p">[</span><span class="sc">'a'</span><span class="p">,</span> <span class="sc">'b'</span><span class="p">,</span> <span class="sc">'c'</span><span class="p">,</span> <span class="sc">'d'</span><span class="p">,</span> <span class="sc">'e'</span><span class="p">,</span> <span class="sc">'f'</span><span class="p">,</span> <span class="sc">'g'</span><span class="p">,</span> <span class="sc">'h'</span><span class="p">,</span> <span class="sc">'i'</span><span class="p">,</span> <span class="sc">'j'</span><span class="p">,</span> <span class="sc">'j'</span><span class="p">,</span> <span class="sc">'j'</span><span class="p">];</span>
    <span class="k">let</span> <span class="n">my_array_s</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s">"Hello"</span><span class="nf">.to_string</span><span class="p">(),</span>
        <span class="s">"World!"</span><span class="nf">.to_string</span><span class="p">(),</span>
        <span class="s">"from Rust!"</span><span class="nf">.to_string</span><span class="p">(),</span>
    <span class="p">];</span>

    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array_f</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array_c</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="p">);</span>

    <span class="k">let</span> <span class="n">my_wrap</span> <span class="o">=</span> <span class="nf">Wrap</span><span class="p">(</span><span class="n">my_array_s</span><span class="p">);</span>
    <span class="nd">println!</span><span class="p">(</span><span class="s">"{}"</span><span class="p">,</span> <span class="n">my_wrap</span><span class="p">);</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Rust’s powerful type inference detects the type of the <code class="language-plaintext highlighter-rouge">Array</code> and it’s size, thanks to const generics!</p><p>And the result in the terminal is the following:</p><div class="language-terminal highlighter-rouge"><div class="code-header"> <span data-label-text="Terminal"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre><td class="rouge-code"><pre><span class="go">λ cargo run -q
</span><span class="gp">Array -&gt;</span><span class="w"> </span>1.5, 2.5, 3.5, 4.5, 5.2, 6.75, 8.9, 8.9, 8.9
<span class="gp">Array -&gt;</span><span class="w"> </span>a, b, c, d, e, f, g, h, i, j, j, j
<span class="gp">Array -&gt;</span><span class="w"> </span>Hello, World!, from Rust!
</pre></table></code></div></div><hr /><p><strong><em>Links, references and disclaimers:</em></strong></p><ul><li>Header Photo by <a href="https://unsplash.com/@pkmfaris">Faris Mohammed</a> on <a href="https://unsplash.com/">Unsplash</a>.<li>The <a href="https://www.rust-lang.org">Rust</a> Programming Language.<li>The <a href="https://doc.rust-lang.org/stable/book/ch19-03-advanced-traits.html#using-the-newtype-pattern-to-implement-external-traits-on-external-types">Rust Programming Language book</a>.<li>Rust’s <a href="https://rust-lang.github.io/rfcs/2000-const-generics.html">Const Generics</a> RFC: 2000-const-generics.<li>The <a href="https://www.haskell.org/">Haskell</a> Programming Language.<li>The <a href="https://wiki.haskell.org/Newtype">Haskell Programming Language Newtype</a>.</ul></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a>, <a href='/categories/traits/'>Traits</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a> <a href="/tags/trait/" class="post-tag no-text-decoration" >trait</a> <a href="/tags/generics/" class="post-tag no-text-decoration" >generics</a> <a href="/tags/newtype/" class="post-tag no-text-decoration" >newtype</a> <a href="/tags/array/" class="post-tag no-text-decoration" >array</a> <a href="/tags/display/" class="post-tag no-text-decoration" >display</a> <a href="/tags/const/" class="post-tag no-text-decoration" >const</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author. <br />Source code samples licensed under <a href="https://mit-license.org/">MIT<a> or <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache-2.0<a></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=Implementing%20the%20Display%20Trait%20on%20a%20Generic%20Array%20using%20Newtype%20Pattern%20-%20the%20trait&url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-use-newtype-pattern-display-trait-array-generics%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=Implementing%20the%20Display%20Trait%20on%20a%20Generic%20Array%20using%20Newtype%20Pattern%20-%20the%20trait&u=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-use-newtype-pattern-display-trait-array-generics%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-use-newtype-pattern-display-trait-array-generics%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/rust-nvim-ide-guide-walkthrough-development-debug/">Rust and Neovim - A Thorough Guide and Walkthrough</a><li><a href="/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/">Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</a><li><a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/">Implementing the Display Trait on a Generic Array using Newtype Pattern</a><li><a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/">Ruxel - Building a Ray Tracer with Rust Part 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/"><div class="card-body"> <em class="small" data-ts="1662471000" data-df="ll" > Sep 6, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>How to Use Rust Traits, Generics and Bounds</h3><div class="text-muted small"><p> Every time I am developing the question I am always asking myself is “is this code idiomatic, ergonomic and extendable enough?” I ask myself that question much more at the beginning, when all the ...</p></div></div></a></div><div class="card"> <a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/"><div class="card-body"> <em class="small" data-ts="1661350800" data-df="ll" > Aug 24, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruxel - Building a Ray Tracer with Rust Part 1</h3><div class="text-muted small"><p> This post is Part 1 in a series to share my journey in developing Ruxel, a simple Ray Tracer and 3D Renderer written in Rust, from scratch. Please see the Series Prelude for more information regar...</p></div></div></a></div><div class="card"> <a href="/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/"><div class="card-body"> <em class="small" data-ts="1664298000" data-df="ll" > Sep 27, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</h3><div class="text-muted small"><p> Check the demo and the GitHub repo. Edit: Since the original post some readers brought to my attention a bug that yielded incorrect decoding. This is now fixed in release v0.1.2. Thanks to ...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/" class="btn btn-outline-primary" prompt="Older"><p>How to Use Rust Traits, Generics and Bounds</p></a> <a href="/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/" class="btn btn-outline-primary" prompt="Newer"><p>Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/rsdlt">Rodrigo Santiago</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."><br />Use of this site is subject to our <a href="/about/#terms-of-use">Terms of Use.<a></span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4YJ2815MJ6"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4YJ2815MJ6'); }); </script>

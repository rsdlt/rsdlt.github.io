<!DOCTYPE html><html lang="en" data-mode="dark" ><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta name="theme-color" media="(prefers-color-scheme: light)" content="#f7f7f7"><meta name="theme-color" media="(prefers-color-scheme: dark)" content="#1b1b1e"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1, shrink-to-fit=no, viewport-fit=cover" ><meta name="generator" content="Jekyll v4.3.2" /><meta property="og:title" content="How to Use Rust Traits, Generics and Bounds" /><meta name="author" content="rsdlt" /><meta property="og:locale" content="en" /><meta name="description" content="Every time I am developing the question I am always asking myself is “is this code idiomatic, ergonomic and extendable enough?”" /><meta property="og:description" content="Every time I am developing the question I am always asking myself is “is this code idiomatic, ergonomic and extendable enough?”" /><link rel="canonical" href="https://rsdlt.github.io/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/" /><meta property="og:url" content="https://rsdlt.github.io/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/" /><meta property="og:site_name" content="the trait" /><meta property="og:image" content="https://rsdlt.github.io/assets/img/rust-generics-traits/brecht-corbeel-8TttTCQLUKw-unsplash.jpg" /><meta property="og:image:height" content="531" /><meta property="og:image:width" content="1229" /><meta property="og:image:alt" content="Photo by Brecht Corbeel via Unsplash" /><meta property="og:type" content="article" /><meta property="article:published_time" content="2022-09-06T09:30:00-04:00" /><meta name="twitter:card" content="summary_large_image" /><meta property="twitter:image" content="https://rsdlt.github.io/assets/img/rust-generics-traits/brecht-corbeel-8TttTCQLUKw-unsplash.jpg" /><meta name="twitter:image:alt" content="Photo by Brecht Corbeel via Unsplash" /><meta property="twitter:title" content="How to Use Rust Traits, Generics and Bounds" /><meta name="twitter:site" content="@_rsdlt" /><meta name="twitter:creator" content="@rsdlt" /> <script type="application/ld+json"> {"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"rsdlt"},"dateModified":"2022-09-06T09:30:00-04:00","datePublished":"2022-09-06T09:30:00-04:00","description":"Every time I am developing the question I am always asking myself is “is this code idiomatic, ergonomic and extendable enough?”","headline":"How to Use Rust Traits, Generics and Bounds","image":{"width":1229,"height":531,"alt":"Photo by Brecht Corbeel via Unsplash","url":"https://rsdlt.github.io/assets/img/rust-generics-traits/brecht-corbeel-8TttTCQLUKw-unsplash.jpg","@type":"imageObject"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://rsdlt.github.io/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/"},"url":"https://rsdlt.github.io/posts/rust-trait-super-generic-polymorphism-subtrait-supertrait-bounds/"}</script><title>How to Use Rust Traits, Generics and Bounds | the trait</title><link rel="apple-touch-icon" sizes="180x180" href="/assets/img/favicons/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="/assets/img/favicons/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="/assets/img/favicons/favicon-16x16.png"><link rel="manifest" href="/assets/img/favicons/site.webmanifest"><link rel="shortcut icon" href="/assets/img/favicons/favicon.ico"><meta name="apple-mobile-web-app-title" content="the trait"><meta name="application-name" content="the trait"><meta name="msapplication-TileColor" content="#da532c"><meta name="msapplication-config" content="/assets/img/favicons/browserconfig.xml"><meta name="theme-color" content="#ffffff"><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://fonts.gstatic.com" crossorigin><link rel="dns-prefetch" href="https://fonts.gstatic.com" crossorigin><link rel="preconnect" href="https://fonts.googleapis.com" ><link rel="dns-prefetch" href="https://fonts.googleapis.com" ><link rel="preconnect" href="https://cdn.jsdelivr.net" ><link rel="dns-prefetch" href="https://cdn.jsdelivr.net" ><link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Lato&family=Source+Sans+Pro:wght@400;600;700;900&display=swap"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="use-credentials"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.11.2/css/all.min.css"><link rel="stylesheet" href="/assets/css/style.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/magnific-popup@1/dist/magnific-popup.min.css"> <script src="https://cdn.jsdelivr.net/npm/jquery@3/dist/jquery.min.js"></script><body data-topbar-visible="true"><div id="sidebar" class="d-flex flex-column align-items-end"><div class="profile-wrapper text-center"><div id="avatar"> <a href="/" class="mx-auto"> <img src="/assets/img/rsdlt_bw.jpg" alt="avatar" onerror="this.style.display='none'"> </a></div><div class="site-title"> <a href="/">the trait</a></div><div class="site-subtitle font-italic">Rodrigo Santiago</div></div><ul class="w-100"><li class="nav-item"> <a href="/" class="nav-link"> <i class="fa-fw fas fa-home ml-xl-3 mr-xl-3 unloaded"></i> <span>HOME</span> </a><li class="nav-item"> <a href="/categories/" class="nav-link"> <i class="fa-fw fas fa-stream ml-xl-3 mr-xl-3 unloaded"></i> <span>CATEGORIES</span> </a><li class="nav-item"> <a href="/tags/" class="nav-link"> <i class="fa-fw fas fa-tag ml-xl-3 mr-xl-3 unloaded"></i> <span>TAGS</span> </a><li class="nav-item"> <a href="/archives/" class="nav-link"> <i class="fa-fw fas fa-archive ml-xl-3 mr-xl-3 unloaded"></i> <span>ARCHIVES</span> </a><li class="nav-item"> <a href="/about/" class="nav-link"> <i class="fa-fw fas fa-info-circle ml-xl-3 mr-xl-3 unloaded"></i> <span>ABOUT</span> </a></ul><div class="sidebar-bottom mt-auto d-flex flex-wrap justify-content-center align-items-center"> <a href="https://github.com/rsdlt" aria-label="github" target="_blank" rel="noopener noreferrer"> <i class="fab fa-github"></i> </a> <a href="javascript:location.href = 'mailto:' + ['rsdlt','pm.me'].join('@')" aria-label="email" > <i class="fas fa-envelope"></i> </a> <a href="/feed.xml" aria-label="rss" > <i class="fas fa-rss"></i> </a> <a href="https://www.linkedin.com/in/rsdlt/" aria-label="linkedin" > <i class="fab fa-linkedin"></i> </a></div></div><div id="topbar-wrapper"><div id="topbar" class="container d-flex align-items-center justify-content-between h-100 pl-3 pr-3 pl-md-4 pr-md-4"> <span id="breadcrumb"> <span> <a href="/"> Home </a> </span> <span>How to Use Rust Traits, Generics and Bounds</span> </span> <i id="sidebar-trigger" class="fas fa-bars fa-fw"></i><div id="topbar-title"> Post</div><i id="search-trigger" class="fas fa-search fa-fw"></i> <span id="search-wrapper" class="align-items-center"> <i class="fas fa-search fa-fw"></i> <input class="form-control" id="search-input" type="search" aria-label="search" autocomplete="off" placeholder="Search..."> </span> <span id="search-cancel" >Cancel</span></div></div><div id="main-wrapper" class="d-flex justify-content-center"><div id="main" class="container pl-xl-4 pr-xl-4"><div class="row"><div id="core-wrapper" class="col-12 col-lg-11 col-xl-9 pr-xl-4"><div class="post pl-1 pr-1 pl-md-2 pr-md-2"><h1 data-toc-skip>How to Use Rust Traits, Generics and Bounds</h1><div class="post-meta text-muted"> <span> Posted <em class="" data-ts="1662471000" data-df="ll" data-toggle="tooltip" data-placement="bottom"> Sep 6, 2022 </em> </span><div class="mt-3 mb-3"> <a href="/assets/img/rust-generics-traits/brecht-corbeel-8TttTCQLUKw-unsplash.jpg" class="popup img-link preview-img shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 1200 630'%3E%3C/svg%3E" data-src="/assets/img/rust-generics-traits/brecht-corbeel-8TttTCQLUKw-unsplash.jpg" alt="Photo by Brecht Corbeel via Unsplash" width="1200" height="630" class="lazyload" data-proofer-ignore></a><figcaption class="text-center pt-2 pb-2">Photo by Brecht Corbeel via Unsplash</figcaption></div><div class="d-flex justify-content-between"> <span> By <em> <a href=""></a> </em> </span><div> <span class="readtime" data-toggle="tooltip" data-placement="bottom" title="2649 words"> <em>14 min</em> read</span></div></div></div><div class="post-content"><p>Every time I am developing the question I am always asking myself is <em>“is this code idiomatic, ergonomic and extendable enough?”</em></p><p>I ask myself that question much more at the beginning, when all the scaffolding and critical building blocks are being created, and <em>particularly</em> when defining types that will be the workhorses of the entire project.</p><p>Because I know that if I don’t do it correctly there will be significant pain in the form of <em>refactoring</em> later on.</p><p>And usually the answer to that question is <em>“yes”</em> up until I make some progress and then I realize that my code was in fact <em>“not extendable enough”</em> or that <em>“there was a better way to do it.”</em></p><p>And then comes the decision to either <em>refactor</em> or continue building on top of the code that I know is just not good enough.</p><p>And this is precisely what just happened with my project <a href="https://github.com/rsdlt/ruxel">Ruxel</a>…</p><p>After I finished developing and testing all the vector and matrix logic for the ray tracer, I came back this weekend to review the code again, including my <a href="https://rsdlt.github.io/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/">Ruxel Part 1</a> post, and I noticed that my implementation could have leveraged <code class="language-plaintext highlighter-rouge">generics</code> and <code class="language-plaintext highlighter-rouge">traits</code> in a much better way by using <code class="language-plaintext highlighter-rouge">trait bounds</code>.</p><p>Hence, I have decided to <em>refactor</em> part of my initial implementation and also share in this post how I plan to leverage Rust’s <code class="language-plaintext highlighter-rouge">Traits</code>, <code class="language-plaintext highlighter-rouge">Generics</code> and <code class="language-plaintext highlighter-rouge">Bounds</code> in a way that makes the code more <em>idiomatic</em>, <em>extendable</em> and <em>ergonomic</em>.</p><h2 id="main-problem"><span class="mr-2">Main Problem</span><a href="#main-problem" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>At the heart of a <code class="language-plaintext highlighter-rouge">ray tracer</code> exist two types: <code class="language-plaintext highlighter-rouge">Vector3</code> and <code class="language-plaintext highlighter-rouge">Point3</code> that are <em>very</em> similar but with key differences, particularly because of its <em>weight</em> <code class="language-plaintext highlighter-rouge">w:</code> component, when expressed in their <em>homogeneous</em> form:</p>\[\begin{align} \vec{v} = \begin{bmatrix} x &amp; y &amp; z &amp; w = 0 \end{bmatrix} \end{align}\] \[\begin{align} \vec{p} = \begin{bmatrix} x &amp; y &amp; z &amp; w = 1 \end{bmatrix} \end{align}\]<p>It’s convenient that both types can be declared with either <code class="language-plaintext highlighter-rouge">floating point</code> or <code class="language-plaintext highlighter-rouge">integer</code> values.</p><p>Both types share <code class="language-plaintext highlighter-rouge">common behavior</code>, but also each one has its own <code class="language-plaintext highlighter-rouge">specific functionality</code>.</p><p>And both types are <em>the</em> workhorses of the entire project so they need to be implemented in the most <em>extendable</em>, <em>ergonomic</em> and <em>idiomatic</em> way.</p><p>In summary, this is the scenario to implement:</p><p><a href="/assets/img/rust-generics-traits/point3-vector3-comparison.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 792 569'%3E%3C/svg%3E" data-src="/assets/img/rust-generics-traits/point3-vector3-comparison.png" alt="Point3 vs Vector3" width="792" height="569" class="lazyload" data-proofer-ignore></a> <em>Point3 vs Vector3</em></p><p>What’s the best approach?</p><h2 id="possible-alternatives"><span class="mr-2">Possible Alternatives</span><a href="#possible-alternatives" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>There are countless ways to approach the implementation of these types in <a href="https://www.rust-lang.org">Rust</a>. However,I think the most common a programmer would try are:</p><ol><li>No generics, no traits<li>Generic structs and traits</ol><p>Let’s review the implications of each in more detail…</p><h3 id="1-no-generics-no-traits"><span class="mr-2">1. No generics, no traits</span><a href="#1-no-generics-no-traits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>To implement this approach, the following <code class="language-plaintext highlighter-rouge">types</code> would be required:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Point3F64</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Point3I64</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Vector3F64</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Vector3I64</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span>
<span class="p">}</span>
</pre></table></code></div></div><p>From the get-go it’s clear that this will become a nightmare, as <strong>each</strong> <code class="language-plaintext highlighter-rouge">struct</code> will need its <strong>own</strong> <code class="language-plaintext highlighter-rouge">impl</code> block like this:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">Vector3F64</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="mf">0f64</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">fn</span> <span class="nf">zero</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="mf">0f64</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="mf">0f64</span><span class="p">,</span>
            <span class="n">z</span><span class="p">:</span> <span class="mf">0f64</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="mf">0f64</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Other Associated Functions</span>

    <span class="k">fn</span> <span class="nf">dot</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Vector3F64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="k">self</span><span class="py">.x</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.x</span> <span class="o">+</span> <span class="k">self</span><span class="py">.y</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.y</span> <span class="o">+</span> <span class="k">self</span><span class="py">.z</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.z</span> <span class="o">+</span> <span class="k">self</span><span class="py">.w</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.w</span>
    <span class="p">}</span>

    <span class="c1">// Other Methods</span>
<span class="p">}</span>
</pre></table></code></div></div><p>And things will get ever more convoluted when implementing <code class="language-plaintext highlighter-rouge">Operator Overloading</code> for each type:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Vector3F64</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">Vector3F64</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Output</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.y</span><span class="p">,</span>
            <span class="n">z</span><span class="p">:</span> <span class="k">self</span><span class="py">.z</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.z</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="k">self</span><span class="py">.z</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.w</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="nb">Add</span> <span class="k">for</span> <span class="n">Vector3I64</span> <span class="p">{</span>
    <span class="k">type</span> <span class="n">Output</span> <span class="o">=</span> <span class="n">Vector3I64</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">add</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="k">Self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">::</span><span class="n">Output</span> <span class="p">{</span>
        <span class="k">Self</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="k">self</span><span class="py">.x</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.x</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="k">self</span><span class="py">.y</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.y</span><span class="p">,</span>
            <span class="n">z</span><span class="p">:</span> <span class="k">self</span><span class="py">.z</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.z</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="k">self</span><span class="py">.z</span> <span class="o">+</span> <span class="n">rhs</span><span class="py">.w</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Following this approach would require implementing:</p><div class="table-wrapper"><table><thead><tr><th> <th>non-generic implementation<tbody><tr><td>Associated functions<td>36<tr><td>Methods<td>14<tr><td>Operator overload functions<td>24<tr><td>Copy attributes<td>4<tr><td>Default attributes<td>4<tr><td>Display, Debug and PartialEq functions<td>1</table></div><p>This approach is:</p><ul><li>Not <em>extendable</em>, because supporting another primitive type like <code class="language-plaintext highlighter-rouge">i32</code> has the effect of requiring an additional:</ul><div class="table-wrapper"><table><thead><tr><th> <th>new primitive<tbody><tr><td>Associated functions<td>13<tr><td>Methods<td>7<tr><td>Operator overload functions<td>11<tr><td>Copy attributes<td>1<tr><td>Default attributes<td>1<tr><td>Display, Debug and PartialEq functions<td>4</table></div><ul><li>Not <em>idiomatic</em>, because it is not:<ul><li>Leveraging the capabilities provided by Rust to solve this particular situation<li>Following the best practices of the Rust community<li>Succint in its approach<li>Using the expressing power of Rust effectively</ul><li>Not <em>ergonomic</em>, because it:<ul><li>Is full of development friction<li>Doesn’t seek simplicity<li>Is inefficient<li>Makes testing exponentially more complicated</ul></ul><p>Hence, unless the intention is to support only one primitive per struct type, this approach should be discarded.</p><h3 id="2-generic-structs-and-traits"><span class="mr-2">2. Generic structs and traits</span><a href="#2-generic-structs-and-traits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h3><p>The next approach involves the use of <code class="language-plaintext highlighter-rouge">generics</code> in the struct declarations as follows:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre><td class="rouge-code"><pre><span class="k">struct</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>

<span class="k">struct</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">y</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">z</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
    <span class="n">w</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span>
<span class="p">}</span>
</pre></table></code></div></div><p>From the start, the required struct declarations are reduced to only <code class="language-plaintext highlighter-rouge">2</code>. Even if in the future the project supports another primitive, like <code class="language-plaintext highlighter-rouge">i32</code> these struct declarations would not change and no additional declarations would be required.</p><p>It’s a big step in the right direction.</p><p>Implementing the associated functions and methods is also more ergonomic and idiomatic with this approach by leveraging Rust’s <code class="language-plaintext highlighter-rouge">trait bounds</code> using the <code class="language-plaintext highlighter-rouge">where</code> keyword:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre><td class="rouge-code"><pre><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">fn</span> <span class="nf">dot</span><span class="p">(</span><span class="k">self</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">T</span>
    <span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">T</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Mul</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">T</span><span class="o">&gt;</span>
    <span class="p">{</span>
        <span class="k">self</span><span class="py">.x</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.x</span> <span class="o">+</span> <span class="k">self</span><span class="py">.y</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.y</span> <span class="o">+</span> <span class="k">self</span><span class="py">.z</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.z</span> <span class="o">+</span> <span class="k">self</span><span class="py">.w</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.w</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The example above will work for any type that implements the <code class="language-plaintext highlighter-rouge">Copy</code>, <code class="language-plaintext highlighter-rouge">Add</code> and <code class="language-plaintext highlighter-rouge">Mul</code> traits, like: <code class="language-plaintext highlighter-rouge">f64</code>, <code class="language-plaintext highlighter-rouge">f32</code>, <code class="language-plaintext highlighter-rouge">i64</code>, <code class="language-plaintext highlighter-rouge">i32</code>, etc.</p><p>There is no more code to write to <em>extend</em> the dot product functionality for more primitives.</p><p>However, in those associated functions where a <code class="language-plaintext highlighter-rouge">value</code>, other than <code class="language-plaintext highlighter-rouge">Default::default()</code>, needs to be specified there is still the need to implement them separately:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span>  <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">{</span>
        <span class="k">Self</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="mf">1f64</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="nb">i64</span><span class="o">&gt;</span><span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span>  <span class="k">-&gt;</span> <span class="k">Self</span><span class="p">{</span>
        <span class="k">Self</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="mi">1i64</span><span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>Yet for the cases where <code class="language-plaintext highlighter-rouge">Default::default()</code> applies there is only one function to specify:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre><td class="rouge-code"><pre><span class="k">impl</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">T</span><span class="o">&gt;</span><span class="p">{</span>
    
    <span class="c1">// Other generic associated functions</span>

    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">T</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">T</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span>
    <span class="k">where</span> <span class="n">T</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Add</span> <span class="o">+</span> <span class="nb">Mul</span> <span class="o">+</span> <span class="nb">Default</span>
    <span class="p">{</span>
        <span class="k">Self</span><span class="p">{</span><span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nn">Default</span><span class="p">::</span><span class="nf">default</span><span class="p">()}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></table></code></div></div><p>This generic <code class="language-plaintext highlighter-rouge">new(...)</code> function of <code class="language-plaintext highlighter-rouge">Vector3&lt;T&gt;</code> will work with any type that implements the <code class="language-plaintext highlighter-rouge">Copy</code> and <code class="language-plaintext highlighter-rouge">Default</code> traits, again like <code class="language-plaintext highlighter-rouge">f64</code>, <code class="language-plaintext highlighter-rouge">f32</code>, etc.</p><p>By my estimations, with this approach the following implementations would be required:</p><div class="table-wrapper"><table><thead><tr><th> <th>generic implementation<tbody><tr><td>Associated functions<td>26<tr><td>Methods<td>6<tr><td>Operator overload functions<td>7<tr><td>Copy attributes<td>2<tr><td>Default attributes<td>2<tr><td>Display, Debug and PartialEq functions<td>3</table></div><p>When compared versus the non-generic approach the improvement is <em>significant</em>:</p><div class="table-wrapper"><table><thead><tr><th> <th>non-generic<th>generic<th>difference<tbody><tr><td>Associated functions<td>36<td>26<td>-10<tr><td>Methods<td>14<td>6<td>-8<tr><td>Operator overload functions<td>24<td>7<td>-17<tr><td>Copy attributes<td>4<td>2<td>-2<tr><td>Default attributes<td>4<td>2<td>-2<tr><td>Display, Debug and PartialEq functions<td>12<td>3<td>-9</table></div><p>Hence, this approach is:</p><ul><li>Much more <em>extendable</em>, because supporting other primitive like <code class="language-plaintext highlighter-rouge">i32</code> would only require an additional:</ul><div class="table-wrapper"><table><thead><tr><th> <th>new primitive<tbody><tr><td>Associated functions<td>9<tr><td>Methods<td>0<tr><td>Operator overload functions<td>0<tr><td>Copy attributes<td>0<tr><td>Default attributes<td>0<tr><td>Display, Debug and PartialEq functions<td>0</table></div><ul><li>More <em>idiomatic</em>, because it:<ul><li>Leverages the <code class="language-plaintext highlighter-rouge">generics</code> capabilities provided by Rust that solve this particular problem<li>Follow the best practices of the Rust community by using ‘trait bounds’ and <code class="language-plaintext highlighter-rouge">generics</code><li>Significantly more succint in the approach, as the comparison table above proved<li>Uses the expressing power of Rust effectively</ul><li>More <em>ergonomic</em>, because it:<ul><li>Has less developer friction: declaring a new Vector is <code class="language-plaintext highlighter-rouge">let v = Vector3::new(...)</code> instead of <code class="language-plaintext highlighter-rouge">let v = Vector3F64::new(...)</code> or <code class="language-plaintext highlighter-rouge">let v = Vector3I32::new(...)</code><li>Seeks simplicity with far less code<li>Is efficient as it enables the same capabilities with less<li>Testing is less burdensome as there are far fewer functions and scenarios to validate</ul></ul><p>It has been a big improvement by utilizing generics with trait bounds.</p><p>And most important: there is no impact on the speed and performance because this implementation is using <code class="language-plaintext highlighter-rouge">static dispatch</code>.</p><h2 id="supertraits-and-subtraits"><span class="mr-2">Supertraits and Subtraits</span><a href="#supertraits-and-subtraits" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>One additional Rust feature to further provide <em>extensibility</em> to the project is to define three traits in order to group the common behavior in a logical way via <code class="language-plaintext highlighter-rouge">supertraits</code> and <code class="language-plaintext highlighter-rouge">subtraits</code>:</p><p><a href="/assets/img/rust-generics-traits/point3-vector3-supertrait-subtrait.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 737 540'%3E%3C/svg%3E" data-src="/assets/img/rust-generics-traits/point3-vector3-supertrait-subtrait.png" alt="Supertrait and Subtrait structure" width="737" height="540" class="lazyload" data-proofer-ignore></a> <em>Tuple Supertrait with Vector and Point Subtraits</em></p><blockquote class="prompt-warning"><p>The important part here is that the subraits <strong>don’t</strong> inherit the functions or methods from the supertrait. Every type that implements the subtrait <strong>must</strong> implement the functions of the supertrait.</p></blockquote><p>What this means in Rust code is the following:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
</pre><td class="rouge-code"><pre><span class="c1">// -- Trait declarations</span>
<span class="k">trait</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span>
    <span class="k">where</span>
        <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Default</span><span class="p">;</span>
<span class="p">}</span>

<span class="k">trait</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">dot</span><span class="p">(</span><span class="n">lhs</span><span class="p">:</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">P</span> 
    <span class="k">where</span>
        <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">P</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Mul</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">P</span><span class="o">&gt;</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">trait</span> <span class="n">Point</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">:</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">origin</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span>
    <span class="k">where</span>
        <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Default</span><span class="p">;</span>
<span class="p">}</span>


<span class="c1">// -- Supertrait implementations</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="k">where</span> <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Default</span><span class="p">{</span>
        <span class="n">Vector3</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span> <span class="nn">Default</span><span class="p">::</span><span class="nf">default</span><span class="p">()</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">f64</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">f64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">Point3</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span><span class="mf">1f64</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">impl</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="nb">i64</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="nb">i64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="nb">i64</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="nb">i64</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">Point3</span> <span class="p">{</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">z</span><span class="p">,</span> <span class="n">w</span><span class="p">:</span><span class="mi">1i64</span> <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// -- Subtrait implementations</span>
<span class="k">impl</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="n">Vector</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">dot</span><span class="p">(</span><span class="n">lhs</span><span class="p">:</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">,</span> <span class="n">rhs</span><span class="p">:</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="n">P</span> 
    <span class="k">where</span>
        <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Add</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">P</span><span class="o">&gt;</span> <span class="o">+</span> <span class="nb">Mul</span><span class="o">&lt;</span><span class="n">Output</span> <span class="o">=</span> <span class="n">P</span><span class="o">&gt;</span><span class="p">,</span>
        <span class="p">{</span>
       <span class="n">lhs</span><span class="py">.x</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.x</span> <span class="o">+</span> <span class="n">lhs</span><span class="py">.w</span> <span class="o">*</span> <span class="n">rhs</span><span class="py">.w</span>
    <span class="p">}</span>

<span class="p">}</span>
</pre></table></code></div></div><p><code class="language-plaintext highlighter-rouge">Vector3&lt;P&gt;</code> and <code class="language-plaintext highlighter-rouge">Point3&lt;P&gt;</code> are implementing the <code class="language-plaintext highlighter-rouge">new(x:...) -&gt; Self</code> function from the <code class="language-plaintext highlighter-rouge">Tuple&lt;P&gt;</code> trait and not from one of its subtraits.</p><p>Because the type <strong>must</strong> implement the supertrait functions of those subtraits that it implements, it’s critical to define under which scope a capability will be defined in order to balance logical grouping and efficiency:</p><ul><li>Supertrait<li>Subtrait<li>Type implementation</ul><p><a href="/assets/img/rust-generics-traits/supertrait-subtrait-tuple-impl.png" class="popup img-link shimmer"><img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 672 804'%3E%3C/svg%3E" data-src="/assets/img/rust-generics-traits/supertrait-subtrait-tuple-impl.png" alt="Supertrait, Subtrait and Type" width="672" height="804" class="lazyload" data-proofer-ignore></a> <em>Type implements supertrait functions, there is no inheritance in Rust</em></p><p>For example, defining the <code class="language-plaintext highlighter-rouge">ones()</code> function -which returns a Vector or Point with ‘1’ value in all its coordinates- in the <code class="language-plaintext highlighter-rouge">Tuple&lt;P&gt;</code> supertrait scope <strong>forces</strong> the implementation of that function in both <code class="language-plaintext highlighter-rouge">Point&lt;P&gt;</code> and <code class="language-plaintext highlighter-rouge">Vector&lt;P&gt;</code> and all of their non-generic implementations like <code class="language-plaintext highlighter-rouge">impl Tuple&lt;i64&gt; for Point3&lt;i64&gt;</code>:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre><td class="rouge-code"><pre><span class="c1">// -- Trait declarations</span>
<span class="k">trait</span> <span class="n">Tuple</span><span class="o">&lt;</span><span class="n">P</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">new</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span> <span class="n">P</span><span class="p">,</span> <span class="n">z</span><span class="p">:</span> <span class="n">P</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="k">Self</span>
    <span class="k">where</span>
        <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Default</span><span class="p">;</span>

    <span class="k">fn</span> <span class="nf">ones</span><span class="p">()</span> <span class="k">-&gt;Self</span>
        <span class="k">where</span> <span class="n">P</span><span class="p">:</span> <span class="nb">Copy</span> <span class="o">+</span> <span class="nb">Default</span><span class="p">;</span>
<span class="p">}</span>
</pre></table></code></div></div><p>The compiler will be happy to let us know where an implementation is missing:</p><div class="language-console highlighter-rouge"><div class="code-header"> <span data-label-text="Console"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
</pre><td class="rouge-code"><pre><span class="gp">Rust/playground on  master [!] &gt;</span><span class="w"> </span>v0.1.0 | v1.63.0
<span class="go"> λ cargo test it_works -- --nocapture
   Compiling playground v0.1.0 (/home/rsdlt/Documents/Rust/playground)
error[E0046]: not all trait items implemented, missing: `ones`
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/lib.rs:46:1
<span class="go">   |
</span><span class="gp">29 | /     fn ones() -&gt;</span>Self
<span class="gp">30 | |         where P: Copy + Default;</span><span class="w">
</span><span class="go">   | |________________________________- `ones` from trait
</span><span class="c">...
</span><span class="gp">46 |   impl&lt;P&gt;</span><span class="w"> </span>Tuple&lt;P&gt; <span class="k">for </span>Vector3&lt;P&gt; <span class="o">{</span>
<span class="go">   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `ones` in implementation

error[E0046]: not all trait items implemented, missing: `ones`
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/lib.rs:52:1
<span class="go">   |
</span><span class="gp">29 | /     fn ones() -&gt;</span>Self
<span class="gp">30 | |         where P: Copy + Default;</span><span class="w">
</span><span class="go">   | |________________________________- `ones` from trait
</span><span class="c">...
</span><span class="gp">52 |   impl Tuple&lt;f64&gt;</span><span class="w"> </span><span class="k">for </span>Point3&lt;f64&gt; <span class="o">{</span>
<span class="go">   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `ones` in implementation

error[E0046]: not all trait items implemented, missing: `ones`
</span><span class="gp">  --&gt;</span><span class="w"> </span>src/lib.rs:58:1
<span class="go">   |
</span><span class="gp">29 | /     fn ones() -&gt;</span>Self
<span class="gp">30 | |         where P: Copy + Default;</span><span class="w">
</span><span class="go">   | |________________________________- `ones` from trait
</span><span class="c">...
</span><span class="gp">58 |   impl Tuple&lt;i64&gt;</span><span class="w"> </span><span class="k">for </span>Point3&lt;i64&gt; <span class="o">{</span>
<span class="go">   |   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ missing `ones` in implementation

For more information about this error, try `rustc --explain E0046`.
error: could not compile `playground` due to 3 previous errors
</span></pre></table></code></div></div><p>It could appear that adding the supertrait and subtrait capabilities is generating more headaches than benefits… However, the benefits of structuring the common behavior this way are in my humble view, the following:</p><ol><li>It forces thinking twice and hard under which scope it makes logical sense to add a new capability.<li>Once defined, the compiler will make sure that the capability is implemented everywhere it needs to be implemented.<li>Having a type defined within the bounds of the supertrait for cases that could be of benefit like <code class="language-plaintext highlighter-rouge">... where T: Tuple + Copy</code>.</ol><h2 id="how-could-i-have-done-better"><span class="mr-2">How could I have done better?</span><a href="#how-could-i-have-done-better" class="anchor text-muted"><i class="fas fa-hashtag"></i></a></h2><p>Going back to <a href="https://rsdlt.github.io/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/">Ruxel Part 1</a> I am basically using two <code class="language-plaintext highlighter-rouge">generic traits</code> called <code class="language-plaintext highlighter-rouge">CoordInit&lt;T, U&gt;</code> and <code class="language-plaintext highlighter-rouge">VecOps&lt;T&gt;</code> which provide coordinate initialization and vector operations’ capabilities, respectively.</p><p>Because they are generic traits, what followed was the implementation of each of those traits over the <code class="language-plaintext highlighter-rouge">Vector3&lt;f64&gt;</code> and <code class="language-plaintext highlighter-rouge">Point3&lt;f64&gt;</code> types:</p><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">VecOps</span><span class="o">&lt;</span><span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;&gt;</span> <span class="k">for</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">magnitude</span><span class="p">(</span><span class="o">&amp;</span><span class="k">self</span><span class="p">)</span> <span class="k">-&gt;</span> <span class="nb">f64</span> <span class="p">{</span>
        <span class="p">(</span><span class="k">self</span><span class="py">.x</span><span class="nf">.powf</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="k">self</span><span class="py">.y</span><span class="nf">.powf</span><span class="p">(</span><span class="mf">2.0</span><span class="p">)</span> <span class="o">+</span> <span class="k">self</span><span class="py">.z</span><span class="nf">.powf</span><span class="p">(</span><span class="mf">2.0</span><span class="p">))</span><span class="nf">.sqrt</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// Rest of Vector3&lt;f64&gt; operation methods and functions</span>
</pre></table></code></div></div><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">CoordInit</span><span class="o">&lt;</span><span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">back</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">Vector3</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">z</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Rest of Vector3&lt;f64&gt; initialization functions</span>
</pre></table></code></div></div><div class="language-rust highlighter-rouge"><div class="code-header"> <span data-label-text="Rust"><i class="fas fa-code small"></i></span> <button aria-label="copy" data-title-succeed="Copied!"><i class="far fa-clipboard"></i></button></div><div class="highlight"><code><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre><td class="rouge-code"><pre><span class="k">impl</span> <span class="n">CoordInit</span><span class="o">&lt;</span><span class="n">Vector3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span><span class="p">,</span> <span class="nb">f64</span><span class="o">&gt;</span> <span class="k">for</span> <span class="n">Point3</span><span class="o">&lt;</span><span class="nb">f64</span><span class="o">&gt;</span> <span class="p">{</span>
    <span class="k">fn</span> <span class="nf">back</span><span class="p">()</span> <span class="k">-&gt;</span> <span class="k">Self</span> <span class="p">{</span>
        <span class="n">Vector3</span> <span class="p">{</span>
            <span class="n">x</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">y</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">z</span><span class="p">:</span> <span class="o">-</span><span class="mf">1.0</span><span class="p">,</span>
            <span class="n">w</span><span class="p">:</span> <span class="mf">0.0</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Rest of Point3&lt;f64&gt; initialization functions</span>
</pre></table></code></div></div><p>Now, how would this approach support the addition of an <code class="language-plaintext highlighter-rouge">i64</code> primitive type?</p><p>Not in a very <em>ergonomic</em> or <em>idiomatic</em> or <em>extendable</em> way.</p><p>Essentially, the following implementation blocks would need to be created and all the existing functions and methods defined for the <code class="language-plaintext highlighter-rouge">f64</code> primitive be repeated (almost carbon copy) for each:</p><ul><li><code class="language-plaintext highlighter-rouge">impl VecOps&lt;Vector3&lt;i64&gt;&gt; for Vector&lt;i64&gt;</code>.<li><code class="language-plaintext highlighter-rouge">impl CoordInit&lt;Vector3&lt;i64&gt;, &lt;i64&gt;&gt; for Vector3&lt;i64&gt;</code>.<li><code class="language-plaintext highlighter-rouge">impl CoordInit&lt;Vector3&lt;i64&gt;, &lt;i64&gt;&gt; for Point3&lt;i64&gt;</code>.<li><code class="language-plaintext highlighter-rouge">impl</code> operator overloading functions for <code class="language-plaintext highlighter-rouge">Add</code>, <code class="language-plaintext highlighter-rouge">AddAssign</code>, <code class="language-plaintext highlighter-rouge">Sub</code>, <code class="language-plaintext highlighter-rouge">SubAssign</code>, <code class="language-plaintext highlighter-rouge">Mul</code>, <code class="language-plaintext highlighter-rouge">Div</code> and <code class="language-plaintext highlighter-rouge">Neg</code> for <code class="language-plaintext highlighter-rouge">i64</code>.</ul><p>So that’s:</p><div class="table-wrapper"><table><thead><tr><th> <th>new primitive<tbody><tr><td>Associated functions<td>36<tr><td>Methods<td>15<tr><td>Operator overload func.<td>14<tr><td>Copy attributes<td>0<tr><td>Default attributes<td>0<tr><td>Display, Debug and PartialEq func.<td>0</table></div><p>For a grand total of <code class="language-plaintext highlighter-rouge">55</code> methods &amp; functions. And this is not counting the additional effort to properly test.</p><p>The approach I took was convenient enough to implement all the functionality quickly, but the solution could be better implemented by properly leveraging Rust’s <code class="language-plaintext highlighter-rouge">generics</code>, <code class="language-plaintext highlighter-rouge">traits</code> and <code class="language-plaintext highlighter-rouge">trait bounds</code>.</p><p>Considering one of my primary <a href="https://rsdlt.github.io/posts/ruxel-ray-tracer-project-first-update-rust-programming-development/#goals-for-ruxel-version-010">Goals</a> is to deliver <em>idiomatic</em> and <em>ergonomic</em> code, a refactoring over the implementation of the <code class="language-plaintext highlighter-rouge">Vector3</code> and <code class="language-plaintext highlighter-rouge">Point3</code> types is due.</p><p>Fortunately, it’s going to be a minor refactor because the project is in its initial stage.</p><hr /><p><strong><em>Links, references and disclaimers:</em></strong></p><p>Header Photo by <a href="https://unsplash.com/@brechtcorbeel">Brecht Corbeel</a> on <a href="https://unsplash.com/">Unsplash</a></p></div><div class="post-tail-wrapper text-muted"><div class="post-meta mb-3"> <i class="far fa-folder-open fa-fw mr-1"></i> <a href='/categories/rust/'>Rust</a>, <a href='/categories/traits/'>Traits</a></div><div class="post-tags"> <i class="fa fa-tags fa-fw mr-1"></i> <a href="/tags/rust/" class="post-tag no-text-decoration" >rust</a> <a href="/tags/trait/" class="post-tag no-text-decoration" >trait</a> <a href="/tags/supertrait/" class="post-tag no-text-decoration" >supertrait</a> <a href="/tags/generics/" class="post-tag no-text-decoration" >generics</a> <a href="/tags/struct/" class="post-tag no-text-decoration" >struct</a> <a href="/tags/refactoring/" class="post-tag no-text-decoration" >refactoring</a> <a href="/tags/bounds/" class="post-tag no-text-decoration" >bounds</a></div><div class="post-tail-bottom d-flex justify-content-between align-items-center mt-3 pt-5 pb-2"><div class="license-wrapper"> This post is licensed under <a href="https://creativecommons.org/licenses/by/4.0/"> CC BY 4.0 </a> by the author. <br />Source code samples licensed under <a href="https://mit-license.org/">MIT<a> or <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache-2.0<a></div><div class="share-wrapper"> <span class="share-label text-muted mr-1">Share</span> <span class="share-icons"> <a href="https://twitter.com/intent/tweet?text=How%20to%20Use%20Rust%20Traits,%20Generics%20and%20Bounds%20-%20the%20trait&url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-trait-super-generic-polymorphism-subtrait-supertrait-bounds%2F" data-toggle="tooltip" data-placement="top" title="Twitter" target="_blank" rel="noopener" aria-label="Twitter"> <i class="fa-fw fab fa-twitter"></i> </a> <a href="https://www.facebook.com/sharer/sharer.php?title=How%20to%20Use%20Rust%20Traits,%20Generics%20and%20Bounds%20-%20the%20trait&u=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-trait-super-generic-polymorphism-subtrait-supertrait-bounds%2F" data-toggle="tooltip" data-placement="top" title="Facebook" target="_blank" rel="noopener" aria-label="Facebook"> <i class="fa-fw fab fa-facebook-square"></i> </a> <a href="https://www.linkedin.com/sharing/share-offsite/?url=https%3A%2F%2Frsdlt.github.io%2Fposts%2Frust-trait-super-generic-polymorphism-subtrait-supertrait-bounds%2F" data-toggle="tooltip" data-placement="top" title="Linkedin" target="_blank" rel="noopener" aria-label="Linkedin"> <i class="fa-fw fab fa-linkedin"></i> </a> <i id="copy-link" class="fa-fw fas fa-link small" data-toggle="tooltip" data-placement="top" title="Copy link" data-title-succeed="Link copied successfully!"> </i> </span></div></div></div></div></div><div id="panel-wrapper" class="col-xl-3 pl-2 text-muted"><div class="access"><div id="access-lastmod" class="post"><div class="panel-heading">Recently Updated</div><ul class="post-content pl-0 pb-1 ml-1 mt-2"><li><a href="/posts/rust-nvim-ide-guide-walkthrough-development-debug/">Rust and Neovim - A Thorough Guide and Walkthrough</a><li><a href="/posts/rust-sycamore-trunk-wasm-iterators-vigenere-cipher/">Building a Real-Time Web Cipher with Rust, Sycamore and Trunk</a><li><a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/">Implementing the Display Trait on a Generic Array using Newtype Pattern</a><li><a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/">Ruxel - Building a Ray Tracer with Rust Part 1</a></ul></div><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="toc-wrapper" class="pl-0 pr-4 mb-5"><div class="panel-heading pl-3 pt-2 mb-2">Contents</div><nav id="toc"></nav></div><script src="https://cdn.jsdelivr.net/npm/tocbot@4.20.1/dist/tocbot.min.js"></script></div></div><div class="row"><div id="tail-wrapper" class="col-12 col-lg-11 col-xl-9 pl-3 pr-3 pr-xl-4 mt-5"><div id="related-posts" class="mb-2 mb-sm-4"><h3 class="pt-2 mb-4 ml-1" data-toc-skip>Further Reading</h3><div class="card-deck mb-4"><div class="card"> <a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/"><div class="card-body"> <em class="small" data-ts="1663409700" data-df="ll" > Sep 17, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Implementing the Display Trait on a Generic Array using Newtype Pattern</h3><div class="text-muted small"><p> Edit: In the original post I said that the PartialEq trait bound was required in the generic Display function implementation; however, if the last element of the array is the same as its predece...</p></div></div></a></div><div class="card"> <a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/"><div class="card-body"> <em class="small" data-ts="1661350800" data-df="ll" > Aug 24, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Ruxel - Building a Ray Tracer with Rust Part 1</h3><div class="text-muted small"><p> This post is Part 1 in a series to share my journey in developing Ruxel, a simple Ray Tracer and 3D Renderer written in Rust, from scratch. Please see the Series Prelude for more information regar...</p></div></div></a></div><div class="card"> <a href="/posts/welcome-blog-rust-technology-development-programming-language/"><div class="card-body"> <em class="small" data-ts="1659846120" data-df="ll" > Aug 7, 2022 </em><h3 class="pt-0 mt-1 mb-3" data-toc-skip>Basic Operator Overloading with Traits</h3><div class="text-muted small"><p> In this post I want to share one of my favorite characteristics about Rust: how it provides the capability to overload an operator to support arithmetic (and other) operations on our own user-defin...</p></div></div></a></div></div></div><div class="post-navigation d-flex justify-content-between"> <a href="/posts/ruxel-part-1-rust-ray-tracer-renderer-3d-development/" class="btn btn-outline-primary" prompt="Older"><p>Ruxel - Building a Ray Tracer with Rust Part 1</p></a> <a href="/posts/rust-use-newtype-pattern-display-trait-array-generics/" class="btn btn-outline-primary" prompt="Newer"><p>Implementing the Display Trait on a Generic Array using Newtype Pattern</p></a></div></div></div></div><div id="search-result-wrapper" class="d-flex justify-content-center unloaded"><div class="col-12 col-sm-11 post-content"><div id="search-hints"><div id="access-tags"><div class="panel-heading">Trending Tags</div><div class="d-flex flex-wrap mt-3 mb-1 mr-3"> <a class="post-tag" href="/tags/rust/">rust</a> <a class="post-tag" href="/tags/trait/">trait</a> <a class="post-tag" href="/tags/3d/">3D</a> <a class="post-tag" href="/tags/array/">array</a> <a class="post-tag" href="/tags/generics/">generics</a> <a class="post-tag" href="/tags/neovim/">neovim</a> <a class="post-tag" href="/tags/ray-tracer/">ray tracer</a> <a class="post-tag" href="/tags/rendering/">rendering</a> <a class="post-tag" href="/tags/struct/">struct</a> <a class="post-tag" href="/tags/bounds/">bounds</a></div></div></div><div id="search-results" class="d-flex flex-wrap justify-content-center text-muted mt-3"></div></div></div></div><footer><div class="container pl-lg-4 pr-lg-4"><div class="d-flex justify-content-between align-items-center text-muted ml-md-3 mr-md-3"><div class="footer-left"><p class="mb-0"> © 2023 <a href="https://github.com/rsdlt">Rodrigo Santiago</a>. <span data-toggle="tooltip" data-placement="top" title="Except where otherwise noted, the blog posts on this site are licensed under the Creative Commons Attribution 4.0 International (CC BY 4.0) License by the author."><br />Use of this site is subject to our <a href="/about/#terms-of-use">Terms of Use.<a></span></p></div><div class="footer-right"><p class="mb-0">Powered by <a href="https://jekyllrb.com" target="_blank" rel="noopener">Jekyll</a> with <a href="https://github.com/cotes2020/jekyll-theme-chirpy" target="_blank" rel="noopener">Chirpy</a> theme.</p></div></div></div></footer><script src="https://cdn.jsdelivr.net/npm/mermaid@8/dist/mermaid.min.js"></script> <script> (function () { function updateMermaid(event) { if (event.source === window && event.data && event.data.direction === ModeToggle.ID) { const mode = event.data.message; if (typeof mermaid === "undefined") { return; } let expectedTheme = (mode === ModeToggle.DARK_MODE ? "dark" : "default"); let config = {theme: expectedTheme}; /* Re-render the SVG › <https://github.com/mermaid-js/mermaid/issues/311#issuecomment-332557344> */ $(".mermaid").each(function () { let svgCode = $(this).prev().children().html(); $(this).removeAttr("data-processed"); $(this).html(svgCode); }); mermaid.initialize(config); mermaid.init(undefined, ".mermaid"); } } let initTheme = "default"; if ($("html[data-mode=dark]").length > 0 || ($("html[data-mode]").length == 0 && window.matchMedia("(prefers-color-scheme: dark)").matches)) { initTheme = "dark"; } let mermaidConf = { theme: initTheme /* <default|dark|forest|neutral> */ }; /* Create mermaid tag */ $("pre").has("code.language-mermaid").each(function () { let svgCode = $(this).children().html(); $(this).addClass("unloaded"); $(this).after(`<pre class=\"mermaid\">${svgCode}</pre>`); }); mermaid.initialize(mermaidConf); window.addEventListener("message", updateMermaid); })(); </script><div id="mask"></div><a id="back-to-top" href="#" aria-label="back-to-top" class="btn btn-lg btn-box-shadow" role="button"> <i class="fas fa-angle-up"></i> </a><div id="notification" class="toast" role="alert" aria-live="assertive" aria-atomic="true" data-animation="true" data-autohide="false"><div class="toast-header"> <button type="button" class="ml-2 ml-auto close" data-dismiss="toast" aria-label="Close"> <span aria-hidden="true">&times;</span> </button></div><div class="toast-body text-center pt-0"><p class="pl-2 pr-2 mb-3">A new version of content is available.</p><button type="button" class="btn btn-primary" aria-label="Update"> Update </button></div></div><script src="https://cdn.jsdelivr.net/npm/simple-jekyll-search@1.10.0/dest/simple-jekyll-search.min.js"></script> <script> SimpleJekyllSearch({ searchInput: document.getElementById('search-input'), resultsContainer: document.getElementById('search-results'), json: '/assets/js/data/search.json', searchResultTemplate: '<div class="pl-1 pr-1 pl-sm-2 pr-sm-2 pl-lg-4 pr-lg-4 pl-xl-0 pr-xl-0"> <a href="{url}">{title}</a><div class="post-meta d-flex flex-column flex-sm-row text-muted mt-1 mb-1"> {categories} {tags}</div><p>{snippet}</p></div>', noResultsText: '<p class="mt-5">Oops! No results found.</p>', templateMiddleware: function(prop, value, template) { if (prop === 'categories') { if (value === '') { return `${value}`; } else { return `<div class="mr-sm-4"><i class="far fa-folder fa-fw"></i>${value}</div>`; } } if (prop === 'tags') { if (value === '') { return `${value}`; } else { return `<div><i class="fa fa-tag fa-fw"></i>${value}</div>`; } } } }); </script> <script src="https://cdn.jsdelivr.net/combine/npm/magnific-popup@1/dist/jquery.magnific-popup.min.js,npm/lazysizes@5.3.2/lazysizes.min.js,npm/clipboard@2/dist/clipboard.min.js"></script> <script src="https://cdn.jsdelivr.net/combine/npm/dayjs@1/dayjs.min.js,npm/dayjs@1/locale/en.min.js,npm/dayjs@1/plugin/relativeTime.min.js,npm/dayjs@1/plugin/localizedFormat.min.js"></script> <script defer src="/assets/js/dist/post.min.js"></script> <script> /* see: <https://docs.mathjax.org/en/latest/options/input/tex.html#tex-options> */ MathJax = { tex: { /* start/end delimiter pairs for in-line math */ inlineMath: [ ['$', '$'], ['\\(', '\\)'] ], /* start/end delimiter pairs for display math */ displayMath: [ ['$$', '$$'], ['\\[', '\\]'] ] } }; </script> <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script> <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script> <script src="https://cdn.jsdelivr.net/npm/bootstrap@4/dist/js/bootstrap.bundle.min.js"></script> <script defer src="/app.js"></script> <script defer src="https://www.googletagmanager.com/gtag/js?id=G-4YJ2815MJ6"></script> <script> document.addEventListener("DOMContentLoaded", function(event) { window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'G-4YJ2815MJ6'); }); </script>
